{"version":3,"file":"sofico-framework-app-config.js","sources":["../../../../projects/sofico-framework/app-config/src/lib/app-config.token.ts","../../../../projects/sofico-framework/app-config/src/lib/services/config.service.ts","../../../../projects/sofico-framework/app-config/src/lib/pipes/currency-config.pipe.ts","../../../../projects/sofico-framework/app-config/src/lib/pipes/date-config.pipe.ts","../../../../projects/sofico-framework/app-config/src/lib/pipes/time-config.pipe.ts","../../../../projects/sofico-framework/app-config/src/lib/pipes/date-time-config.pipe.ts","../../../../projects/sofico-framework/app-config/src/lib/app-config.module.ts","../../../../projects/sofico-framework/app-config/src/lib/app-config-utils.module.ts","../../../../projects/sofico-framework/app-config/src/public-api.ts","../../../../projects/sofico-framework/app-config/src/sofico-framework-app-config.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\nimport { AppConfig } from './types/app-config.type';\n\nexport const APP_CONFIG_TOKEN = new InjectionToken<AppConfig>(\n  'app-config-token'\n);\n","import { Inject, Injectable } from '@angular/core';\nimport { ObjectService, WindowRefService } from '@sofico-framework/utils';\nimport { APP_CONFIG_TOKEN } from '../app-config.token';\nimport { AppConfig } from '../types/app-config.type';\nimport { Config } from '../types/config.type';\nimport { ProvisioningConfig } from '../types/provisioning-config.type';\n\n@Injectable()\nexport class ConfigService {\n  public config: Config;\n\n  /**\n   * The config that is set on the nativeWindow\n   */\n  private provisioningConfig: ProvisioningConfig = this.windowRefService\n    .nativeWindow.config;\n\n  constructor(\n    @Inject(APP_CONFIG_TOKEN) private appConfig: AppConfig,\n    private windowRefService: WindowRefService,\n    private objectService: ObjectService\n  ) {\n    // provisioning config requirement\n    if (!this.provisioningConfig) {\n      throw Error('No provisioning configuration found!');\n    }\n\n    if (\n      !(\n        this.provisioningConfig.auth?.clientId ||\n        this.provisioningConfig.base?.clientId\n      )\n    ) {\n      throw Error('auth.clientId is required in configuration!');\n    }\n\n    const location = this.windowRefService.nativeWindow.location;\n    const defaultConfig: Config = {\n      api: {\n        baseUrl: `${location.protocol}//${location.host}/api`\n      },\n      auth: {\n        clientId: '',\n        allowedUrls: [`${location.protocol}//${location.host}`],\n        baseUrl: `${location.protocol}//${location.host}/auth/realms/`,\n        grant: 'implicit',\n        realm: 'master',\n        logoutRedirectUrls: []\n      },\n      debug: false,\n      app: appConfig\n    };\n\n    let baseConfig: Config;\n    if (this.provisioningConfig?.base) {\n      baseConfig = {\n        api: {\n          baseUrl: `https://${this.provisioningConfig.base.domain}/api`\n        },\n        auth: {\n          clientId: this.provisioningConfig.base.clientId,\n          allowedUrls: [`https://${this.provisioningConfig.base.domain}/api`],\n          baseUrl: `https://${this.provisioningConfig.base.domain}/auth/realms/`,\n          grant: 'implicit',\n          realm: 'master',\n          logoutRedirectUrls: []\n        },\n        app: appConfig\n      };\n    }\n\n    let config: Config = this.objectService.mergeDeep(\n      defaultConfig,\n      baseConfig,\n      this.provisioningConfig\n    );\n\n    // We ensure the API and AUTH baseUrl have a trailing slash\n    config = {\n      ...config,\n      api: {\n        ...config.api,\n        baseUrl: this.getValidUrl(config.api.baseUrl)\n      },\n      auth: {\n        ...config.auth,\n        baseUrl: this.getValidUrl(config.auth.baseUrl)\n      }\n    };\n    this.config = config;\n  }\n\n  private getValidUrl(url: string): string {\n    if (url?.substr(-1) !== '/') {\n      return `${url}/`;\n    }\n    return url;\n  }\n}\n","import { CurrencyPipe } from '@angular/common';\nimport { Pipe, PipeTransform } from '@angular/core';\nimport { ConfigService } from '../services/config.service';\n\n@Pipe({ name: 'sofCurrencyConfig' })\nexport class CurrencyConfigPipe implements PipeTransform {\n  constructor(\n    private currencyPipe: CurrencyPipe,\n    private configService: ConfigService\n  ) {}\n\n  transform(value: any): string {\n    return this.currencyPipe.transform(\n      value,\n      this.configService.config.app.currencyCode\n    );\n  }\n}\n","import { DatePipe } from '@angular/common';\nimport { Pipe, PipeTransform } from '@angular/core';\nimport { ConfigService } from '../services/config.service';\n\n@Pipe({ name: 'sofDateConfig' })\nexport class DateConfigPipe implements PipeTransform {\n  constructor(\n    private datePipe: DatePipe,\n    private configService: ConfigService\n  ) {}\n\n  transform(value: any): string {\n    return this.datePipe.transform(\n      value,\n      this.configService.config.app.dateFormat\n    );\n  }\n}\n","import { DatePipe } from '@angular/common';\nimport { Pipe, PipeTransform } from '@angular/core';\nimport { ConfigService } from '../services/config.service';\n\n@Pipe({ name: 'sofTimeConfig' })\nexport class TimeConfigPipe implements PipeTransform {\n  constructor(\n    private configService: ConfigService,\n    private datePipe: DatePipe\n  ) {}\n\n  transform(value: string): string {\n    const dateTimeString = `1970-01-01 ${value}`;\n    return this.datePipe.transform(\n      dateTimeString,\n      this.configService.config.app.timeFormat\n    );\n  }\n}\n","import { DatePipe } from '@angular/common';\nimport { Pipe, PipeTransform } from '@angular/core';\nimport { ConfigService } from '../services/config.service';\n\n@Pipe({ name: 'sofDateTimeConfig' })\nexport class DateTimeConfigPipe implements PipeTransform {\n  constructor(\n    private configService: ConfigService,\n    private datePipe: DatePipe\n  ) {}\n\n  transform(value: any): string {\n    return this.datePipe.transform(\n      value,\n      this.configService.config.app.dateFormat +\n        ' ' +\n        this.configService.config.app.timeFormat\n    );\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport {\n  Inject,\n  ModuleWithProviders,\n  NgModule,\n  Optional,\n  SkipSelf\n} from '@angular/core';\n\nimport { WindowRefService } from '@sofico-framework/utils';\nimport { APP_CONFIG_TOKEN } from './app-config.token';\nimport { ConfigService } from './services/config.service';\nimport { AppConfig } from './types/app-config.type';\n\n@NgModule({\n  imports: [CommonModule],\n  providers: [ConfigService]\n})\nexport class AppConfigModule {\n  constructor(\n    @Optional() @SkipSelf() parentModule: AppConfigModule,\n    @Optional() @Inject(APP_CONFIG_TOKEN) private appConfig: AppConfig,\n    @Optional() windowRefService: WindowRefService\n  ) {\n    if (parentModule) {\n      throw new Error(\n        'AppConfigModule is already loaded. Import in your base AppModule only.'\n      );\n    }\n    if (!appConfig) {\n      throw Error(\n        `${AppConfigModule.name} should be imported using forRoot static method!`\n      );\n    }\n    if (!windowRefService) {\n      throw new Error(\n        'You need to import the UtilServicesModule in your AppModule!'\n      );\n    }\n  }\n\n  static forRoot(config: AppConfig): ModuleWithProviders<AppConfigModule> {\n    return {\n      ngModule: AppConfigModule,\n      providers: [\n        {\n          provide: APP_CONFIG_TOKEN,\n          useValue: config\n        }\n      ]\n    };\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { CurrencyConfigPipe } from './pipes/currency-config.pipe';\nimport { DateConfigPipe } from './pipes/date-config.pipe';\nimport { DateTimeConfigPipe } from './pipes/date-time-config.pipe';\nimport { TimeConfigPipe } from './pipes/time-config.pipe';\n\n@NgModule({\n  imports: [CommonModule],\n  declarations: [\n    CurrencyConfigPipe,\n    DateConfigPipe,\n    TimeConfigPipe,\n    DateTimeConfigPipe\n  ],\n  exports: [\n    CurrencyConfigPipe,\n    DateConfigPipe,\n    TimeConfigPipe,\n    DateTimeConfigPipe\n  ]\n})\nexport class AppConfigUtilsModule {}\n","/*\n * Public API Surface of app-config\n */\n\n// pipes\nexport * from './lib/pipes/currency-config.pipe';\nexport * from './lib/pipes/date-config.pipe';\nexport * from './lib/pipes/time-config.pipe';\nexport * from './lib/pipes/date-time-config.pipe';\n\n// services\nexport * from './lib/services/config.service';\n\n// types\nexport * from './lib/types/app-config.type';\nexport * from './lib/types/config.type';\nexport * from './lib/types/auth-config.type';\nexport * from './lib/types/base-config.type';\n\n// modules\nexport * from './lib/app-config.module';\nexport * from './lib/app-config-utils.module';\n\n// token\nexport * from './lib/app-config.token';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}