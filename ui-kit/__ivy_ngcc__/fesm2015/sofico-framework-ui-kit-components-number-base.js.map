{"version":3,"file":"sofico-framework-ui-kit-components-number-base.js","sources":["../../../../projects/sofico-framework/ui-kit/components/number-base/number-base.directive.ts","../../../../projects/sofico-framework/ui-kit/components/number-base/sofico-framework-ui-kit-components-number-base.ts"],"names":[],"mappings":";;;;;;MAYa,wBAAwB;AAAG,IADxC;AACG;AAAY;AAAyC;AAAY,QAczD,gBAAW,GAAG,EAAE,CAAC;AAC5B;AAEK;AAEE;AAAY,QAaP,gBAAW,GAAG,IAAI,YAAY,EAAU,CAAC;AACrD;AAEK;AAEA;AAAY,QAAL,UAAK,GAAG,IAAI,YAAY,EAAO,CAAC;AAC5C,QAIE,kBAAa,GAAW,IAAI,CAAC;AAC/B;AACmB,QAGjB,mBAAc,GAAG,CAAC,CAAC;AACrB,QACU,UAAK,GAAW,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;AAC1E,KAiIC;AACD;AAAQ;AAAgE;AAAQ,IA5J9E,IAAa,WAAW,CAAC,KAAa;AACxC,QAAI,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;AAChC,QAAI,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;AACnD,KAAG;AACH,IAuBE,gBAAgB,CAAC,EAAO;AAAI,QAC1B,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;AAC9B,KAAG;AACH,IACE,iBAAiB,CAAC,EAAO;AAAI,QAC3B,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;AAC7B,KAAG;AACH,IACE,UAAU,CAAC,GAAQ;AAAI;AACkC,QACvD,MAAM,mBAAmB,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;AACpD;AACI,QAAA,IAAI,mBAAmB,KAAK,IAAI,IAAI,mBAAmB,KAAK,SAAS,EAAE;AAC3E;AACM,YAAA,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;AAChC,SAAK;AAAC,aAAK;AACX;AACM;AACM,YAAN,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;AAClD,gBAAQ,MAAM,gBAAgB,GACpB,mBAAmB,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC;AACjE,gBAAQ,IAAI,CAAC,aAAa,GAAG,mBAAmB,CAAC,MAAM,CAC7C,CAAC,EACD,gBAAgB,GAAG,CAAC,CACrB,CAAC;AACV,aAAO;AAAC,iBAAK;AACb,gBAAQ,IAAI,CAAC,aAAa,GAAG,mBAAmB,CAAC;AACjD,aAAO;AACP,SAAK;AACL,KAAG;AACH,IACE,QAAQ,CAAC,KAAa;AAAI,QACxB,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;AAC1B;AACM,YAAA,MAAM,aAAa,GAAG,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC;AAC/D;AAEK,YAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;AAC3C;AAEK,YAAC,IAAI,IAAI,CAAC,eAAe,IAAI,aAAa,KAAK,SAAS,EAAE;AAC/D,gBAAQ,IAAI,CAAC,eAAe,CAClB,aAAa,KAAK,IAAI;AAChC,sBAAc,IAAI;AAClB,sBAAc,MAAM,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAC7C,CAAC;AACV,aAAO;AACP,SAAK;AACL,KAAG;AACH,IACE,sBAAsB,CAAC,KAAa;AAAI,QACtC,IAAI,KAAK,KAAK,SAAS,EAAE;AAC7B;AACM,YAAA,MAAM,mBAAmB,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;AACxD;AACM,YAAA,IAAI,mBAAmB,KAAK,SAAS,EAAE;AAC7C;AACQ,gBAAA,IAAI,CAAC,eAAe,EAAE,CAAC;AAC/B,aAAO;AAAC,iBAAK;AACb;AACQ,gBAAA,IACE,EAAC,mBAAmB,aAAnB,mBAAmB,uBAAnB,mBAAmB,CAAE,KAAK,CAAC,IAAI,CAAC,KAAK,EAAC;AACjD,oBAAU,CAAC,iBAAiB,CAAC,mBAAmB,CAAC,EACvC;AACV,oBAAU,IAAI,CAAC,eAAe,EAAE,CAAC;AACjC,oBAAU,OAAO,IAAI,CAAC,aAAa,CAAC;AACpC,iBAAS;AACT;AACQ,gBAAA,MAAM,0BAA0B,GAC9B,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;AACnD,gBAAQ,IAAI,CAAC,0BAA0B,EAAE;AACzC,oBAAU,IAAI,CAAC,aAAa,GAAG,mBAAmB,CAAC;AACnD,iBAAS;AACT,gBAAQ,OAAO,mBAAmB,CAAC;AACnC,aAAO;AACP,SAAK;AACL,KAAG;AACH,IACE,OAAO;AAAK,QACV,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;AACtB,QACI,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,cAAc,EAAE;AACjD,YAAM,IAAI,CAAC,cAAc,EAAE,CAAC;AAC5B,SAAK;AACL,KAAG;AACH,IACE,gBAAgB,CAAC,KAAc;AAAI,QACjC,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;AAC5B,KAAG;AACH,IACE,eAAe;AAAK,QAClB,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC;AAC/D,KAAG;AACH;AAEC;AACE;AACE;AACE;AACE;AACE;AAEJ;AAAQ,IAAb,SAAS,CAAC,KAAa;AAAI;AACF,QACvB,IAAI,OAAe,CAAC;AACxB;AACI,QAAA,IAAI,KAAK,KAAK,SAAS,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,EAAE,EAAE;AAC/D,YAAM,OAAO,GAAG,IAAI,CAAC;AACrB;AACM,SAAD;AAAC,aAAK;AACX,YAAM,MAAM,aAAa,GAAG,KAAK,CAAC,QAAQ,EAAE,CAAC;AAC7C,YAAM,IAAI,aAAa,KAAK,GAAG,EAAE;AACjC,gBAAQ,OAAO,GAAG,IAAI,CAAC;AACvB,aAAO;AAAC,iBAAK,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC,OAAO,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,EAAE;AAC9D,gBAAQ,OAAO,GAAG,GAAG,CAAC;AACtB,aAAO;AAAC,iBAAK,IACL,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC;AAC/D,gBAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,mBAAmB,CAAC,IAAI,EAAE,EAAE,MAAM,EACvD;AACR,gBAAQ,OAAO,GAAG,aAAa,CAAC;AAChC,aAAO;AACP,SAAK;AACL,QAAI,OAAO,OAAO,CAAC;AACnB,KAAG;AACH,IACU,qBAAqB,CAAC,KAAa;AAAI,QAC7C,OAAO,IAAI,MAAM,CAAC,gCAAgC,KAAK,IAAI,EAAE,GAAG,CAAC,CAAC;AACtE,KAAG;AACH;oDApLC,SAAS;;;;;;gNACR;AAAC;AAA4C,yBAI5C,KAAK;AAAK,yBAKV,KAAK;AAAK,0BAKV,KAAK;AAAK,sBAKV,KAAK;AAAK,0BAKV,KAAK;AAAK,0BAQV,MAAM;AAAK,oBAKX,MAAM;AAAK,2BAEX,SAAS,SAAC,cAAc;AACvB;;;;;;;;;;;;;;;;;;;;oBAAE;AAAC;ACpDP;AACA;AACA;AACA;AACA;AACO","sourcesContent":["import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  Input,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport { ControlValueAccessor } from '@angular/forms';\nimport { isNullOrUndefined } from '@sofico-framework/utils';\n\n@Directive()\nexport class InputNumberBaseDirective implements ControlValueAccessor {\n  /**\n   * The id of the input to connect to a label tag.\n   */\n  @Input() labelForId: string;\n\n  /**\n   *  Determines if the input is disabled.\n   */\n  @Input() isDisabled: boolean;\n\n  /**\n   * The placeholder of the input.\n   */\n  @Input() placeholder = '';\n\n  /**\n   * Determines whether the input is in a valid state.\n   */\n  @Input() invalid: boolean;\n\n  /**\n   * Determines if there is a max number of decimals allowed.\n   */\n  @Input() set maxFraction(value: number) {\n    this.fractionDigits = value;\n    this.regex = this.buildMaxFractionRegex(value);\n  }\n\n  /**\n   * EventEmitter that will emit the value when changed.\n   */\n  @Output() changeValue = new EventEmitter<string>();\n\n  /**\n   * EventEmitter that will emit when control is touched.\n   */\n  @Output() touch = new EventEmitter<any>();\n\n  @ViewChild('inputElement')\n  inputElement: ElementRef;\n\n  internalValue: string = null;\n  propagateChange: any;\n  propagateTouch: any;\n\n  // The default decimal places is 2\n  fractionDigits = 2;\n\n  private regex: RegExp = this.buildMaxFractionRegex(this.fractionDigits);\n\n  registerOnChange(fn: any): void {\n    this.propagateChange = fn;\n  }\n\n  registerOnTouched(fn: any): void {\n    this.propagateTouch = fn;\n  }\n\n  writeValue(obj: any): void {\n    // convert string input to prepare it for number casting\n    const inputValueAsDecimal = this.toDecimal(obj);\n    // if conversion results in null or undefined\n    if (inputValueAsDecimal === null || inputValueAsDecimal === undefined) {\n      // block the input value\n      this.internalValue = null;\n    } else {\n      // this regex only fails when there are too many fraction digits\n      // so this will cut off the unnecessary digits\n      if (!inputValueAsDecimal.match(this.regex)) {\n        const maxFractionIndex =\n          inputValueAsDecimal.indexOf('.') + this.fractionDigits;\n        this.internalValue = inputValueAsDecimal.substr(\n          0,\n          maxFractionIndex + 1\n        );\n      } else {\n        this.internalValue = inputValueAsDecimal;\n      }\n    }\n  }\n\n  onChange(value: string): void {\n    if (!this.isDisabled) {\n      // update internal value\n      const internalValue = this.updateValueByUserInput(value);\n\n      // emit value\n      this.changeValue.emit(internalValue);\n\n      // propagate the change\n      if (this.propagateChange && internalValue !== undefined) {\n        this.propagateChange(\n          internalValue === null\n            ? null\n            : Number(internalValue.replace(/,/g, '.'))\n        );\n      }\n    }\n  }\n\n  updateValueByUserInput(value: string): string {\n    if (value !== undefined) {\n      // convert string input to prepare it for number casting\n      const inputValueAsDecimal = this.toDecimal(value);\n      // if conversion results in undefined\n      if (inputValueAsDecimal === undefined) {\n        // block the input value\n        this.blockInputValue();\n      } else {\n        // if processed value contains too many decimals, block the input value\n        if (\n          !inputValueAsDecimal?.match(this.regex) &&\n          !isNullOrUndefined(inputValueAsDecimal)\n        ) {\n          this.blockInputValue();\n          return this.internalValue;\n        }\n        // else, assign processed input value to internal value, unless not desired\n        const allowModelToDifferFromView =\n          ['-', '+', '.', ','].indexOf(value) > -1;\n        if (!allowModelToDifferFromView) {\n          this.internalValue = inputValueAsDecimal;\n        }\n        return inputValueAsDecimal;\n      }\n    }\n  }\n\n  onTouch(): void {\n    this.touch.emit();\n\n    if (!this.isDisabled && this.propagateTouch) {\n      this.propagateTouch();\n    }\n  }\n\n  setDisabledState(value: boolean): void {\n    this.isDisabled = value;\n  }\n\n  blockInputValue(): void {\n    this.inputElement.nativeElement.value = this.internalValue;\n  }\n\n  /**\n   * Converts string to undefined, null or the original input value. The purpose is to validate whether or not it has a decimal-like structure,\n   * while preparing the return value for easy castability to a number, while preserving the input its decimal locale flexibility. Returns\n   * null if it detects emptyness. Returns the input value if it could convert it to a simple decimal-like value, not accepting scientific\n   * variables (eg. Euler's number). Thus, string validation only allows a signed floating point value, with comma or point as decimal\n   * separator, without thousand separators. Returns undefined in all other cases.\n   * @param value String value of which to retrieve a decimal-like conversion\n   */\n  toDecimal(value: string): string {\n    // default it to undefined\n    let decimal: string;\n    // set it to null if naturally numerically empty\n    if (value === undefined || value === null || value === '') {\n      decimal = null;\n      // else, make it castable to number, processed using natural (not pure JavaScript) logic\n    } else {\n      const valueToString = value.toString();\n      if (valueToString === '-') {\n        decimal = '-0';\n      } else if (['+', '.', ','].indexOf(valueToString) > -1) {\n        decimal = '0';\n      } else if (\n        !Number.isNaN(Number(valueToString.replace(/,/g, '.'))) &&\n        (valueToString.match(/^[\\+\\-]?[0-9.,]+$/) || []).length\n      ) {\n        decimal = valueToString;\n      }\n    }\n    return decimal;\n  }\n\n  private buildMaxFractionRegex(value: number): RegExp {\n    return new RegExp(`^[\\\\+\\\\-]*\\\\d*[\\\\,\\\\.]?\\\\d{0,${value}}$`, 'g');\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"]}