{"version":3,"file":"sofico-framework-ui-kit-components-input-multi-select.js","sources":["../../../../projects/sofico-framework/ui-kit/components/input-multi-select/input-multi-select.component.ts","../../../../projects/sofico-framework/ui-kit/components/input-multi-select/input-multi-select.module.ts","../../../../projects/sofico-framework/ui-kit/components/input-multi-select/sofico-framework-ui-kit-components-input-multi-select.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Host,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Optional,\n  Output,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core';\nimport { ControlValueAccessor, FormControl, NgControl } from '@angular/forms';\nimport { FormComponent } from '@sofico-framework/ui-kit/components/form';\nimport {\n  OnSofFocus,\n  SOF_FOCUS_COMPONENT\n} from '@sofico-framework/ui-kit/directives/focus';\nimport { SearchFnSelect, SearchOption } from '@sofico-framework/ui-kit/types';\nimport {\n  NzFilterOptionType,\n  NzSelectItemInterface,\n  NzSelectSizeType\n} from 'ng-zorro-antd/select';\nimport { Changes, takeUntilDestroy, UntilDestroy } from 'ngx-reactivetoolkit';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\n@UntilDestroy()\n@Component({\n  selector: 'sof-input-multi-select',\n  styleUrls: ['./input-multi-select.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n  template: `\n    <div class=\"multi-select\">\n      <nz-select\n        #inputElement\n        [@.disabled]=\"true\"\n        [formControl]=\"internalFormControl\"\n        [nzOptions]=\"formattedOptions$ | async\"\n        nzMode=\"multiple\"\n        [nzSize]=\"size\"\n        [nzShowArrow]=\"true\"\n        [nzShowSearch]=\"showSearch\"\n        [nzAllowClear]=\"clearable\"\n        [nzBorderless]=\"borderless\"\n        [nzDisabled]=\"isDisabled\"\n        [nzFilterOption]=\"nzSearchFn\"\n        [nzPlaceHolder]=\"placeholder\"\n        [nzNotFoundContent]=\"tc + notFoundContent | translate\"\n        [nzTokenSeparators]=\"tokenSeparators\"\n        [nzMaxTagCount]=\"maxTagCount\"\n        [class.is-invalid]=\"\n          invalid ||\n          (ngControl?.invalid && (ngControl?.touched || form?.submitted))\n        \"\n        (nzBlur)=\"onTouch()\"\n      ></nz-select>\n    </div>\n  `,\n  providers: [\n    { provide: SOF_FOCUS_COMPONENT, useExisting: InputMultiSelectComponent }\n  ]\n})\nexport class InputMultiSelectComponent\n  implements ControlValueAccessor, OnChanges, OnInit, OnDestroy, OnSofFocus {\n  constructor(\n    @Optional() public form: FormComponent,\n    @Optional() @Host() public ngControl: NgControl,\n    private changeDetectorRef: ChangeDetectorRef\n  ) {\n    if (ngControl) {\n      ngControl.valueAccessor = this;\n    }\n  }\n\n  @Input() tc: string;\n\n  // Size of Select input\n  @Input() size: NzSelectSizeType = 'large';\n\n  // Whether to show the search icon\n  @Input() showSearch = true;\n\n  // Whether to show the clear button icon\n  @Input() clearable = true;\n\n  // Whether the select has borderless styling\n  @Input() borderless = false;\n\n  // Specify content to show when no result matches..\n  @Input() notFoundContent = '.NOT-FOUND';\n\n  // The placeholder of the input.\n  @Input() placeholder = '';\n\n  // Separator used to tokenize on tag/multiple mode\n  @Input() tokenSeparators = [','];\n\n  // TODO remove or keep, if keep what default value do we use\n  //  Max selected option can be selected\n  @Input() maxMultipleCount: number;\n\n  // Max tag count to show\n  @Input() maxTagCount = 5;\n\n  /**\n   * The id of the input to connect to a label tag.\n   * currently not supported\n   */\n  @Input() labelForId: string;\n\n  /**\n   *  Determines if the input is disabled.\n   */\n  @Input() isDisabled: boolean;\n\n  /**\n   * The options that populate the list.\n   */\n  @Input() options: any[];\n\n  /**\n   * Determines which property that must be used as list label.\n   */\n  @Input() selectorLabel: (x: any) => any;\n\n  /**\n   * Determines which property that must be used as list value.\n   */\n  @Input() selectorValue: (x: any) => any;\n\n  /**\n   * Determines which property that must be used as option disable.\n   */\n  @Input() selectorDisabled: (x: any) => any;\n\n  /**\n   * Determines whether the input is in a valid state.\n   */\n  @Input() invalid: boolean;\n\n  /**\n   * EventEmitter that will emit the value when changed.\n   */\n  @Output() changeValue = new EventEmitter<any>();\n\n  // Form control used instead in simple value, as the ng-select component has internal implementation we can't reach.\n  // By making use of a form control internally we have all the features available.\n  internalFormControl = new FormControl([]);\n  propagateChange: any;\n  propagateTouch: any;\n\n  // source streams\n  @Changes('options') options$: Observable<any[]>;\n\n  // presentation streams\n  formattedOptions$: Observable<\n    { label: string; value: any; disabled: boolean }[]\n  >;\n\n  @ViewChild('inputElement', { read: ElementRef }) inputElement: ElementRef;\n\n  // Determines how the search is done.\n  @Input() searchFn: SearchFnSelect = (input: string, x: SearchOption) =>\n    x?.label?.toLowerCase().startsWith(input.toLowerCase());\n\n  nzSearchFn: NzFilterOptionType = (input: string, x: NzSelectItemInterface) =>\n    this.searchFn(input, { label: x.nzLabel as string, value: x.nzValue });\n\n  sofFocus(): void {\n    this.inputElement.nativeElement.getElementsByTagName('input')[0].focus();\n    this.changeDetectorRef.detectChanges();\n  }\n\n  ngOnInit(): void {\n    this.formattedOptions$ = this.options$.pipe(\n      map(options => options ?? []),\n      map(options =>\n        options.map(option => ({\n          label: this.selectorLabel(option),\n          value: this.selectorValue(option),\n          disabled: this.selectorDisabled ? this.selectorDisabled(option) : null\n        }))\n      )\n    );\n\n    // the reason why we're using valueChanges instead of fn ngModelChange\n    // is because:\n    // When we want to update the single-select without that the user\n    // did something we will trigger the fn writeValue. That fn\n    // will update the form value.\n    // When we update the value we're aware of the change of the value.\n    // So sometimes we don't want that valueChanges isn't triggered.\n    // that's possible by adding { emitEvent: false } to the patchValue\n    // but when you use the fn ngModelChange he will ignore the\n    // { emitEvent: false } option. So to use that we need to\n    // listen on the valueChanges events instead.\n    this.internalFormControl.valueChanges\n      .pipe(takeUntilDestroy(this))\n      .subscribe(value => {\n        if (!this.isDisabled) {\n          this.changeValue.emit(this.internalFormControl.value);\n\n          if (this.propagateChange) {\n            this.propagateChange(this.internalFormControl.value);\n          }\n        }\n      });\n  }\n\n  ngOnChanges(): void {}\n\n  ngOnDestroy(): void {\n    if (this.ngControl?.valueAccessor) {\n      // Every time a control is re-created the previous writeValue reference(s) is not cleaned up.\n      // So, over time, a lot of these references can be built up. This memory leak is a bug in Angular's implementation of ControlValueAccessor.\n      // We hide that problem by assigning an empty function to writeValue every time we destroy the control.\n      // An detailed explanation of the problem can be found here: https://github.com/angular/angular/pull/29335\n      // The bug issue for it: https://github.com/angular/angular/issues/20007\n      this.ngControl.valueAccessor.writeValue = () => {};\n    }\n  }\n\n  registerOnChange(fn: any): void {\n    this.propagateChange = fn;\n  }\n\n  registerOnTouched(fn: any): void {\n    this.propagateTouch = fn;\n  }\n\n  writeValue(value: any): void {\n    this.internalFormControl.setValue(value ?? [], { emitEvent: false });\n  }\n\n  onTouch(): void {\n    if (!this.isDisabled && this.propagateTouch) {\n      this.propagateTouch();\n    }\n  }\n\n  setDisabledState(value: boolean): void {\n    this.isDisabled = value;\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { NzSelectModule } from 'ng-zorro-antd/select';\nimport { InputMultiSelectComponent } from './input-multi-select.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    ReactiveFormsModule,\n    NzSelectModule,\n    FormsModule,\n    TranslateModule\n  ],\n  declarations: [InputMultiSelectComponent],\n  exports: [InputMultiSelectComponent]\n})\nexport class InputMultiSelectModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"]}