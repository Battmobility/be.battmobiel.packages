{"version":3,"file":"sofico-framework-ui-kit-components-input-switch.umd.js","sources":["../../../../projects/sofico-framework/ui-kit/components/input-switch/input-switch.component.ts","../../../../projects/sofico-framework/ui-kit/components/input-switch/input-switch.module.ts","../../../../projects/sofico-framework/ui-kit/components/input-switch/sofico-framework-ui-kit-components-input-switch.ts"],"sourcesContent":["import {\n  Component,\n  ElementRef,\n  EventEmitter,\n  Host,\n  Input,\n  OnDestroy,\n  Optional,\n  Output,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core';\nimport { ControlValueAccessor, NgControl } from '@angular/forms';\nimport { FormComponent } from '@sofico-framework/ui-kit/components/form';\nimport {\n  OnSofFocus,\n  SOF_FOCUS_COMPONENT\n} from '@sofico-framework/ui-kit/directives/focus';\n\nlet uniqueSwitchCounter = 0;\n\n@Component({\n  selector: 'sof-input-switch',\n  styleUrls: ['./input-switch.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n  template: `\n    <div class=\"custom-control custom-switch\">\n      <input\n        #inputElement\n        type=\"checkbox\"\n        [attr.id]=\"labelForId\"\n        [disabled]=\"isDisabled\"\n        class=\"custom-control-input\"\n        [class.is-invalid]=\"\n          invalid ||\n          (ngControl?.invalid && (ngControl?.touched || form?.submitted))\n        \"\n        [checked]=\"internalValue\"\n        [attr.value]=\"internalValue\"\n        (change)=\"onToggle($event)\"\n      />\n      <label [for]=\"labelForId\" class=\"custom-control-label\">\n        {{ label }}\n      </label>\n    </div>\n  `,\n  providers: [\n    { provide: SOF_FOCUS_COMPONENT, useExisting: InputSwitchComponent }\n  ]\n})\nexport class InputSwitchComponent\n  implements ControlValueAccessor, OnDestroy, OnSofFocus {\n  /**\n   * The translated label of the input.\n   */\n  @Input() label: string;\n\n  /**\n   *  Determines if the input is disabled.\n   */\n  @Input() isDisabled: boolean;\n\n  /**\n   * Determines whether the input is in a valid state.\n   */\n  @Input() invalid: boolean;\n\n  /**\n   * Determines if the input is checked or not.\n   */\n  @Input() set selected(value: boolean) {\n    this.writeValue(value);\n    this.calculateIndeterminate();\n  }\n\n  /**\n   * Determines if the input is indeterminate or not.\n   * Checked true will always prevail over indeterminate true.\n   */\n  @Input() set indeterminate(value: boolean) {\n    this.isIndeterminate = value;\n    this.calculateIndeterminate();\n  }\n\n  /**\n   * EventEmitter that will emit the value when changed.\n   */\n  @Output() changeValue = new EventEmitter<boolean>();\n\n  /**\n   * EventEmitter that will emit when control is touched.\n   */\n  @Output() touch = new EventEmitter<any>();\n\n  @ViewChild('inputElement', { static: true }) inputElement: ElementRef;\n\n  internalValue: boolean = null;\n  isIndeterminate = false;\n  propagateChange: any;\n  propagateTouch: any;\n  labelForId = 'sof-input-switch-' + uniqueSwitchCounter; // generate unique id\n\n  constructor(\n    @Optional() public form: FormComponent,\n    @Optional() @Host() public ngControl: NgControl\n  ) {\n    ++uniqueSwitchCounter;\n    if (ngControl) {\n      ngControl.valueAccessor = this;\n    }\n  }\n\n  sofFocus(): void {\n    this.inputElement.nativeElement.focus();\n  }\n\n  ngOnDestroy(): void {\n    if (this.ngControl?.valueAccessor) {\n      // Every time a control is re-created the previous writeValue reference(s) is not cleaned up.\n      // So, over time, a lot of these references can be built up. This memory leak is a bug in Angular's implementation of ControlValueAccessor.\n      // We hide that problem by assigning an empty function to writeValue every time we destroy the control.\n      // An detailed explanation of the problem can be found here: https://github.com/angular/angular/pull/29335\n      // The bug issue for it: https://github.com/angular/angular/issues/20007\n      this.ngControl.valueAccessor.writeValue = () => {};\n    }\n  }\n\n  registerOnChange(fn: any): void {\n    this.propagateChange = fn;\n  }\n\n  registerOnTouched(fn: any): void {\n    this.propagateTouch = fn;\n  }\n\n  writeValue(value: boolean): void {\n    this.internalValue = value;\n  }\n\n  onToggle(event: any): void {\n    // Prevent native functionality of browser input-checkbox\n    event.preventDefault();\n\n    if (!this.isDisabled) {\n      this.calculateIndeterminate();\n      const newValue = !this.internalValue;\n      if (this.propagateChange) {\n        this.internalValue = newValue;\n        this.propagateChange(newValue);\n      }\n      this.changeValue.emit(newValue);\n    }\n\n    // Must happen after propagateChange, if not it will not work properly when formControl has set updateOn: 'blur'.\n    // When updateOn: 'blur' is set the form control will only emit a value once the control is out of focus.\n    // By calling propagateTouch before propagateChange the old value is used as initial value instead of the new value.\n    // It seems that every propagateChange is ignored once the propagateTouch is triggered.\n    // The problem doesn't occur when updateOn is 'change' (default) as the control is not limited by propagateTouch.\n    this.onTouch();\n  }\n\n  onTouch(): void {\n    this.touch.emit();\n\n    if (!this.isDisabled && this.propagateTouch) {\n      this.propagateTouch();\n    }\n  }\n\n  setDisabledState(isDisabled: boolean): void {\n    this.isDisabled = isDisabled;\n  }\n\n  private calculateIndeterminate(): void {\n    this.inputElement.nativeElement.indeterminate =\n      this.isIndeterminate && !this.internalValue;\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { InputSwitchComponent } from './input-switch.component';\n\n@NgModule({\n  imports: [CommonModule],\n  declarations: [InputSwitchComponent],\n  exports: [InputSwitchComponent]\n})\nexport class InputSwitchModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["EventEmitter","Component","ViewEncapsulation","SOF_FOCUS_COMPONENT","FormComponent","Optional","NgControl","Host","Input","Output","ViewChild","NgModule","CommonModule"],"mappings":"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"}