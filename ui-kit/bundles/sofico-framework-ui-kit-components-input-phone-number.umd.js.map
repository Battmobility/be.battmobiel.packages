{"version":3,"file":"sofico-framework-ui-kit-components-input-phone-number.umd.js","sources":["../../../../projects/sofico-framework/ui-kit/components/input-phone-number/utils/phone-numbers.utils.ts","../../../../projects/sofico-framework/ui-kit/components/input-phone-number/input-phone-number.component.ts","../../../../projects/sofico-framework/ui-kit/components/input-phone-number/input-phone-number.module.ts","../../../../projects/sofico-framework/ui-kit/components/input-phone-number/validators/phone-number.validator.ts","../../../../projects/sofico-framework/ui-kit/components/input-phone-number/sofico-framework-ui-kit-components-input-phone-number.ts"],"sourcesContent":["import { PhoneNumber, PhoneNumberUtil } from 'google-libphonenumber';\n\nconst phoneUtil: PhoneNumberUtil = PhoneNumberUtil.getInstance();\n\nexport function calculatePhoneNumber(\n  countryCodeISO2: string,\n  localCode: string\n): PhoneNumber {\n  if (countryCodeISO2 && localCode) {\n    try {\n      // can throw an Error, therefore it's inside a try-catch\n      return phoneUtil.parseAndKeepRawInput(localCode, countryCodeISO2);\n    } catch (e) {}\n  }\n\n  return null;\n}\n","import {\n  Component,\n  ElementRef,\n  EventEmitter,\n  Host,\n  Input,\n  OnDestroy,\n  Optional,\n  Output,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core';\nimport { ControlValueAccessor, FormControl, NgControl } from '@angular/forms';\nimport { FormComponent } from '@sofico-framework/ui-kit/components/form';\nimport {\n  OnSofFocus,\n  SOF_FOCUS_COMPONENT\n} from '@sofico-framework/ui-kit/directives/focus';\nimport {\n  PhoneNumber,\n  PhoneNumberFormat,\n  PhoneNumberUtil\n} from 'google-libphonenumber';\nimport { Country } from './types/country.type';\nimport { InputPhoneNumber } from './types/input-phone-number.type';\nimport { calculatePhoneNumber } from './utils/phone-numbers.utils';\n\n@Component({\n  selector: 'sof-input-phone-number',\n  styleUrls: ['./input-phone-number.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n  template: `\n    <div class=\"input-group\">\n      <div class=\"input-group-prepend\">\n        <sof-input-single-select\n          [tc]=\"tc\"\n          [formControl]=\"singleSelectFormControl\"\n          [labelForId]=\"labelForId\"\n          [options]=\"countries\"\n          [selectorLabel]=\"selectorLabel\"\n          [selectorValue]=\"selectorValue\"\n          [clearable]=\"false\"\n          [isDisabled]=\"internalDisabled\"\n          [invalid]=\"\n            invalid ||\n            (ngControl?.invalid && (ngControl?.touched || form?.submitted))\n          \"\n          (touch)=\"onTouch(false)\"\n          (changeValue)=\"onChangeCountryCode($event)\"\n        ></sof-input-single-select>\n      </div>\n      <input\n        #inputElement\n        type=\"text\"\n        class=\"form-control\"\n        [class.is-invalid]=\"\n          invalid ||\n          (ngControl?.invalid && (ngControl?.touched || form?.submitted))\n        \"\n        [attr.disabled]=\"internalDisabled\"\n        [placeholder]=\"placeholder\"\n        [value]=\"internalValue.localCode\"\n        (blur)=\"onTouch()\"\n        (input)=\"onChangeLocalCode($event.target?.value)\"\n      />\n    </div>\n  `,\n  providers: [\n    { provide: SOF_FOCUS_COMPONENT, useExisting: InputPhoneNumberComponent }\n  ]\n})\nexport class InputPhoneNumberComponent\n  implements ControlValueAccessor, OnDestroy, OnSofFocus {\n  @Input() tc: string;\n\n  /**\n   * The id of the input to connect to a label tag.\n   */\n  @Input() labelForId: string;\n\n  /**\n   *  Determines if the input is disabled.\n   */\n  @Input() set isDisabled(value: boolean) {\n    this.setDisabledState(value);\n  }\n\n  /**\n   * The placeholder of the input.\n   */\n  @Input() placeholder = '';\n\n  /**\n   * The countries that populate the list.\n   */\n  @Input() countries: Country[];\n\n  /**\n   * Determines whether the input is in a valid state.\n   */\n  @Input() invalid: boolean;\n\n  /**\n   * Determines the value of the control.\n   */\n  @Input() set value(value: InputPhoneNumber) {\n    this.writeValue(value);\n  }\n\n  /**\n   * EventEmitter that will emit the value when changed.\n   */\n  @Output() changeValue = new EventEmitter<InputPhoneNumber>();\n\n  @ViewChild('inputElement') inputElement: ElementRef;\n\n  private phoneUtil: PhoneNumberUtil = PhoneNumberUtil.getInstance();\n  private phoneNumber: PhoneNumber = null; // store the calculated phone number\n\n  singleSelectFormControl: FormControl = new FormControl(null); // used to be able to set default value\n  internalValue: InputPhoneNumber = {\n    countryCodeISO2: null,\n    localCode: null\n  };\n  internalDisabled: boolean;\n  propagateChange: any;\n  propagateTouch: any;\n\n  selectorLabel = (x: Country) =>\n    `+${x.countryPhoneCode} (${x.countryCodeISO3})`;\n  selectorValue = (x: Country) => x.countryCodeISO2;\n\n  constructor(\n    @Optional() public form: FormComponent,\n    @Optional() @Host() public ngControl: NgControl\n  ) {\n    if (ngControl) {\n      ngControl.valueAccessor = this;\n    }\n  }\n\n  sofFocus(): void {\n    this.inputElement.nativeElement.focus();\n  }\n\n  ngOnDestroy(): void {\n    if (this.ngControl?.valueAccessor) {\n      // Every time a control is re-created the previous writeValue reference(s) is not cleaned up.\n      // So, over time, a lot of these references can be built up. This memory leak is a bug in Angular's implementation of ControlValueAccessor.\n      // We hide that problem by assigning an empty function to writeValue every time we destroy the control.\n      // An detailed explanation of the problem can be found here: https://github.com/angular/angular/pull/29335\n      // The bug issue for it: https://github.com/angular/angular/issues/20007\n      this.ngControl.valueAccessor.writeValue = () => {};\n    }\n  }\n\n  registerOnChange(fn: any): void {\n    this.propagateChange = fn;\n  }\n\n  registerOnTouched(fn: any): void {\n    this.propagateTouch = fn;\n  }\n\n  writeValue(value: InputPhoneNumber): void {\n    this.internalValue = {\n      countryCodeISO2: value?.countryCodeISO2 ?? null,\n      localCode: value?.localCode ?? null\n    };\n\n    // set the default value of the single select control\n    this.singleSelectFormControl.setValue(this.internalValue.countryCodeISO2);\n\n    this.phoneNumber = calculatePhoneNumber(\n      this.internalValue.countryCodeISO2,\n      this.internalValue.localCode\n    );\n  }\n\n  setDisabledState(isDisabled: boolean): void {\n    this.internalDisabled = isDisabled;\n\n    if (isDisabled) {\n      this.singleSelectFormControl.disable();\n    } else {\n      this.singleSelectFormControl.enable();\n    }\n  }\n\n  onChangeCountryCode(countryCodeISO2: string): void {\n    if (!this.isDisabled) {\n      this.phoneNumber = calculatePhoneNumber(\n        countryCodeISO2,\n        this.internalValue.localCode\n      );\n\n      this.emitAndPropagate(countryCodeISO2, this.internalValue.localCode);\n    }\n  }\n\n  onChangeLocalCode(localCode: string): void {\n    if (!this.isDisabled) {\n      this.phoneNumber = calculatePhoneNumber(\n        this.internalValue.countryCodeISO2,\n        localCode\n      );\n\n      this.emitAndPropagate(this.internalValue.countryCodeISO2, localCode);\n    }\n  }\n\n  onTouch(propagate: boolean = true): void {\n    if (this.phoneNumber) {\n      this.internalValue = this.formatPhoneNumber(\n        this.internalValue,\n        this.phoneNumber\n      );\n    }\n\n    if (!this.isDisabled && this.propagateTouch && propagate) {\n      this.propagateTouch();\n    }\n  }\n\n  /**\n   * format phone number, in control, in a more readable style (ex. 0475201414 => 0475 20 14 14)\n   */\n  private formatPhoneNumber(\n    value: InputPhoneNumber,\n    phoneNumber: PhoneNumber\n  ): InputPhoneNumber {\n    return {\n      ...value,\n      localCode: this.phoneUtil.format(phoneNumber, PhoneNumberFormat.NATIONAL)\n    };\n  }\n\n  private emitAndPropagate(countryCodeISO2: string, localCode: string): void {\n    const tmpCountryCodeISO2 = countryCodeISO2 ?? null;\n    const tmpLocalCode = localCode ?? null;\n    // number without country prefix and/or 0-prefix (ex. +320475201414 => 475201414)\n    // phone number is equal to null when 1 character is inside the control, so first default to localCode before we accept null as a value\n    const nationalPhoneNumber =\n      this.phoneNumber?.getNationalNumber()?.toString() ?? tmpLocalCode;\n\n    const checkForNullValues =\n      tmpLocalCode === null ||\n      tmpLocalCode === '' ||\n      tmpCountryCodeISO2 === null;\n\n    if (checkForNullValues) {\n      this.changeValue.emit(null);\n    } else {\n      this.changeValue.emit({\n        countryCodeISO2: tmpCountryCodeISO2,\n        localCode: nationalPhoneNumber\n      });\n    }\n\n    if (this.propagateChange) {\n      // only set internal value when in context of a reactive form, not when used standalone\n      this.internalValue = {\n        countryCodeISO2: tmpCountryCodeISO2,\n        localCode: tmpLocalCode\n      };\n      // emit new form value with corrected localCode\n      if (checkForNullValues) {\n        this.propagateChange(null);\n      } else {\n        this.propagateChange({\n          ...this.internalValue,\n          localCode: nationalPhoneNumber\n        });\n      }\n    }\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { InputSingleSelectModule } from '@sofico-framework/ui-kit/components/input-single-select';\nimport { InputPhoneNumberComponent } from './input-phone-number.component';\n\n@NgModule({\n  imports: [CommonModule, InputSingleSelectModule, ReactiveFormsModule],\n  declarations: [InputPhoneNumberComponent],\n  exports: [InputPhoneNumberComponent]\n})\nexport class InputPhoneNumberModule {}\n","import { AbstractControl, ValidationErrors } from '@angular/forms';\nimport { PhoneNumberUtil } from 'google-libphonenumber';\nimport { calculatePhoneNumber } from '../utils/phone-numbers.utils';\n\nconst phoneUtil: PhoneNumberUtil = PhoneNumberUtil.getInstance();\n\nexport function phoneNumberValidator(\n  control: AbstractControl\n): ValidationErrors | null {\n  if (!control?.value?.localCode) {\n    return null;\n  }\n  const phoneNumber = calculatePhoneNumber(\n    control?.value?.countryCodeISO2,\n    control?.value?.localCode\n  );\n  if (\n    phoneNumber &&\n    phoneUtil.isValidNumberForRegion(\n      phoneNumber,\n      control.value?.countryCodeISO2\n    )\n  ) {\n    return null;\n  }\n\n  return {\n    phoneNumber: true\n  };\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["phoneUtil","PhoneNumberUtil","EventEmitter","FormControl","PhoneNumberFormat","Component","ViewEncapsulation","SOF_FOCUS_COMPONENT","FormComponent","Optional","NgControl","Host","Input","Output","ViewChild","NgModule","CommonModule","InputSingleSelectModule","ReactiveFormsModule"],"mappings":";;;;;;IAEA,IAAMA,WAAS,GAAoBC,oCAAe,CAAC,WAAW,EAAE,CAAC;aAEjD,oBAAoB,CAClC,eAAuB,EACvB,SAAiB;QAEjB,IAAI,eAAe,IAAI,SAAS,EAAE;YAChC,IAAI;;gBAEF,OAAOD,WAAS,CAAC,oBAAoB,CAAC,SAAS,EAAE,eAAe,CAAC,CAAC;aACnE;YAAC,OAAO,CAAC,EAAE,GAAE;SACf;QAED,OAAO,IAAI,CAAC;IACd;;;QCoHE,mCACqB,IAAmB,EACX,SAAoB;YAD5B,SAAI,GAAJ,IAAI,CAAe;YACX,cAAS,GAAT,SAAS,CAAW;;;;YA5CxC,gBAAW,GAAG,EAAE,CAAC;;;;YAsBhB,gBAAW,GAAG,IAAIE,iBAAY,EAAoB,CAAC;YAIrD,cAAS,GAAoBD,oCAAe,CAAC,WAAW,EAAE,CAAC;YAC3D,gBAAW,GAAgB,IAAI,CAAC;YAExC,4BAAuB,GAAgB,IAAIE,iBAAW,CAAC,IAAI,CAAC,CAAC;YAC7D,kBAAa,GAAqB;gBAChC,eAAe,EAAE,IAAI;gBACrB,SAAS,EAAE,IAAI;aAChB,CAAC;YAKF,kBAAa,GAAG,UAAC,CAAU,IACzB,OAAA,MAAI,CAAC,CAAC,gBAAgB,UAAK,CAAC,CAAC,eAAe,MAAG,GAAA,CAAC;YAClD,kBAAa,GAAG,UAAC,CAAU,IAAK,OAAA,CAAC,CAAC,eAAe,GAAA,CAAC;YAMhD,IAAI,SAAS,EAAE;gBACb,SAAS,CAAC,aAAa,GAAG,IAAI,CAAC;aAChC;SACF;QAxDD,sBAAa,iDAAU;;;;iBAAvB,UAAwB,KAAc;gBACpC,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;aAC9B;;;WAAA;QAoBD,sBAAa,4CAAK;;;;iBAAlB,UAAmB,KAAuB;gBACxC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;aACxB;;;WAAA;QAkCD,4CAAQ,GAAR;YACE,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;SACzC;QAED,+CAAW,GAAX;;YACE,UAAI,IAAI,CAAC,SAAS,0CAAE,aAAa,EAAE;;;;;;gBAMjC,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,UAAU,GAAG,eAAQ,CAAC;aACpD;SACF;QAED,oDAAgB,GAAhB,UAAiB,EAAO;YACtB,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;SAC3B;QAED,qDAAiB,GAAjB,UAAkB,EAAO;YACvB,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;SAC1B;QAED,8CAAU,GAAV,UAAW,KAAuB;;YAChC,IAAI,CAAC,aAAa,GAAG;gBACnB,eAAe,QAAE,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,eAAe,mCAAI,IAAI;gBAC/C,SAAS,QAAE,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,SAAS,mCAAI,IAAI;aACpC,CAAC;;YAGF,IAAI,CAAC,uBAAuB,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;YAE1E,IAAI,CAAC,WAAW,GAAG,oBAAoB,CACrC,IAAI,CAAC,aAAa,CAAC,eAAe,EAClC,IAAI,CAAC,aAAa,CAAC,SAAS,CAC7B,CAAC;SACH;QAED,oDAAgB,GAAhB,UAAiB,UAAmB;YAClC,IAAI,CAAC,gBAAgB,GAAG,UAAU,CAAC;YAEnC,IAAI,UAAU,EAAE;gBACd,IAAI,CAAC,uBAAuB,CAAC,OAAO,EAAE,CAAC;aACxC;iBAAM;gBACL,IAAI,CAAC,uBAAuB,CAAC,MAAM,EAAE,CAAC;aACvC;SACF;QAED,uDAAmB,GAAnB,UAAoB,eAAuB;YACzC,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;gBACpB,IAAI,CAAC,WAAW,GAAG,oBAAoB,CACrC,eAAe,EACf,IAAI,CAAC,aAAa,CAAC,SAAS,CAC7B,CAAC;gBAEF,IAAI,CAAC,gBAAgB,CAAC,eAAe,EAAE,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;aACtE;SACF;QAED,qDAAiB,GAAjB,UAAkB,SAAiB;YACjC,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;gBACpB,IAAI,CAAC,WAAW,GAAG,oBAAoB,CACrC,IAAI,CAAC,aAAa,CAAC,eAAe,EAClC,SAAS,CACV,CAAC;gBAEF,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,aAAa,CAAC,eAAe,EAAE,SAAS,CAAC,CAAC;aACtE;SACF;QAED,2CAAO,GAAP,UAAQ,SAAyB;YAAzB,0BAAA,EAAA,gBAAyB;YAC/B,IAAI,IAAI,CAAC,WAAW,EAAE;gBACpB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,iBAAiB,CACzC,IAAI,CAAC,aAAa,EAClB,IAAI,CAAC,WAAW,CACjB,CAAC;aACH;YAED,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,cAAc,IAAI,SAAS,EAAE;gBACxD,IAAI,CAAC,cAAc,EAAE,CAAC;aACvB;SACF;;;;QAKO,qDAAiB,GAAjB,UACN,KAAuB,EACvB,WAAwB;YAExB,uCACK,KAAK,KACR,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,WAAW,EAAEC,sCAAiB,CAAC,QAAQ,CAAC,IACzE;SACH;QAEO,oDAAgB,GAAhB,UAAiB,eAAuB,EAAE,SAAiB;;YACjE,IAAM,kBAAkB,GAAG,eAAe,aAAf,eAAe,cAAf,eAAe,GAAI,IAAI,CAAC;YACnD,IAAM,YAAY,GAAG,SAAS,aAAT,SAAS,cAAT,SAAS,GAAI,IAAI,CAAC;;;YAGvC,IAAM,mBAAmB,qBACvB,IAAI,CAAC,WAAW,0CAAE,iBAAiB,4CAAI,QAAQ,qCAAM,YAAY,CAAC;YAEpE,IAAM,kBAAkB,GACtB,YAAY,KAAK,IAAI;gBACrB,YAAY,KAAK,EAAE;gBACnB,kBAAkB,KAAK,IAAI,CAAC;YAE9B,IAAI,kBAAkB,EAAE;gBACtB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aAC7B;iBAAM;gBACL,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;oBACpB,eAAe,EAAE,kBAAkB;oBACnC,SAAS,EAAE,mBAAmB;iBAC/B,CAAC,CAAC;aACJ;YAED,IAAI,IAAI,CAAC,eAAe,EAAE;;gBAExB,IAAI,CAAC,aAAa,GAAG;oBACnB,eAAe,EAAE,kBAAkB;oBACnC,SAAS,EAAE,YAAY;iBACxB,CAAC;;gBAEF,IAAI,kBAAkB,EAAE;oBACtB,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;iBAC5B;qBAAM;oBACL,IAAI,CAAC,eAAe,iCACf,IAAI,CAAC,aAAa,KACrB,SAAS,EAAE,mBAAmB,IAC9B,CAAC;iBACJ;aACF;SACF;;;;gBAxPFC,cAAS,SAAC;oBACT,QAAQ,EAAE,wBAAwB;oBAElC,aAAa,EAAEC,sBAAiB,CAAC,IAAI;oBACrC,QAAQ,EAAE,0qCAmCT;oBACD,SAAS,EAAE;wBACT,EAAE,OAAO,EAAEC,yBAAmB,EAAE,WAAW,EAAE,yBAAyB,EAAE;qBACzE;;iBACF;;;gBAzDQC,kBAAa,uBAwHjBC,aAAQ;gBAzH+BC,eAAS,uBA0HhDD,aAAQ,YAAIE,SAAI;;;qBA7DlBC,UAAK;6BAKLA,UAAK;6BAKLA,UAAK;8BAOLA,UAAK;4BAKLA,UAAK;0BAKLA,UAAK;wBAKLA,UAAK;8BAOLC,WAAM;+BAENC,cAAS,SAAC,cAAc;;;;QCvG3B;;;;;gBALCC,aAAQ,SAAC;oBACR,OAAO,EAAE,CAACC,mBAAY,EAAEC,yCAAuB,EAAEC,yBAAmB,CAAC;oBACrE,YAAY,EAAE,CAAC,yBAAyB,CAAC;oBACzC,OAAO,EAAE,CAAC,yBAAyB,CAAC;iBACrC;;;ICND,IAAM,SAAS,GAAoBjB,oCAAe,CAAC,WAAW,EAAE,CAAC;aAEjD,oBAAoB,CAClC,OAAwB;;QAExB,IAAI,QAAC,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,KAAK,0CAAE,SAAS,CAAA,EAAE;YAC9B,OAAO,IAAI,CAAC;SACb;QACD,IAAM,WAAW,GAAG,oBAAoB,OACtC,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,KAAK,0CAAE,eAAe,QAC/B,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,KAAK,0CAAE,SAAS,CAC1B,CAAC;QACF,IACE,WAAW;YACX,SAAS,CAAC,sBAAsB,CAC9B,WAAW,QACX,OAAO,CAAC,KAAK,0CAAE,eAAe,CAC/B,EACD;YACA,OAAO,IAAI,CAAC;SACb;QAED,OAAO;YACL,WAAW,EAAE,IAAI;SAClB,CAAC;IACJ;;IC7BA;;;;;;;;;;;;;;;"}