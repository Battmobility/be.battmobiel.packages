{"version":3,"file":"sofico-framework-ui-kit-components-pie-chart.js","sources":["../../../../projects/sofico-framework/ui-kit/components/pie-chart/pie-chart.component.ts","../../../../projects/sofico-framework/ui-kit/components/pie-chart/pie-chart.module.ts","../../../../projects/sofico-framework/ui-kit/components/pie-chart/sofico-framework-ui-kit-components-pie-chart.ts"],"sourcesContent":["import {\n  AfterViewInit,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport {\n  ChartIdentifierConfig,\n  SingleValueChartValue\n} from '@sofico-framework/ui-kit/types';\nimport { Chart } from 'chart.js';\nimport { Changes, takeUntilDestroy, UntilDestroy } from 'ngx-reactivetoolkit';\nimport { combineLatest } from 'rxjs';\n\n@UntilDestroy()\n@Component({\n  selector: 'sof-pie-chart',\n  template: `\n    <div class=\"chart-container\" style=\"position: relative;  width:100%\">\n      <canvas #chart></canvas>\n    </div>\n  `,\n  styleUrls: ['./pie-chart.component.scss']\n})\nexport class PieChartComponent\n  implements OnDestroy, OnInit, OnChanges, AfterViewInit {\n  @ViewChild('chart', { static: true })\n  chartElem: ElementRef<HTMLCanvasElement>;\n  @Input() identifiersConfig: ChartIdentifierConfig[];\n  @Input() tooltipFn: (\n    label: string,\n    value: string,\n    identifier?: string\n  ) => string;\n  @Input() chartData: SingleValueChartValue[];\n  @Changes('identifiersConfig') identifiersConfig$;\n  @Changes('chartData') chartData$;\n  private chart: Chart;\n  private barChartData: any;\n\n  constructor(private cdRef: ChangeDetectorRef) {\n    this.cdRef.detach();\n  }\n\n  ngOnChanges(): void {}\n\n  ngOnInit(): void {\n    combineLatest([this.identifiersConfig$, this.chartData$])\n      .pipe(takeUntilDestroy(this))\n      .subscribe(([identifiersConfig, values]) => {\n        this.setData(\n          identifiersConfig as ChartIdentifierConfig[],\n          values as SingleValueChartValue[]\n        );\n      });\n  }\n\n  ngOnDestroy(): void {\n    this?.chart?.destroy();\n  }\n\n  ngAfterViewInit(): void {\n    const ctx = this.chartElem.nativeElement.getContext('2d');\n    this.chart = new Chart(ctx, {\n      type: 'pie',\n      data: this.barChartData,\n      options: {\n        tooltips: {\n          callbacks: {\n            label: (tooltipItem, data) => {\n              if (this.tooltipFn) {\n                const label = data.labels[tooltipItem.index] as any;\n                const value = data.datasets[0].data[tooltipItem.index] as any;\n                const identifier = (data.datasets[0] as any).identifiers[\n                  tooltipItem.index\n                ];\n                return this.tooltipFn(label, value, identifier);\n              }\n            }\n          }\n        },\n        legend: {\n          align: 'start',\n          rtl: true\n        } as any,\n        aspectRatio: 1,\n        responsive: true\n      }\n    });\n  }\n\n  private setData(\n    identifiersConfig: ChartIdentifierConfig[],\n    values: SingleValueChartValue[]\n  ): void {\n    if (!values || !identifiersConfig) {\n      return;\n    }\n    const labels = identifiersConfig.map(v => v.label);\n    this.barChartData = {\n      labels,\n      datasets: [\n        {\n          data: values.map(v => v?.value),\n          identifiers: identifiersConfig.map(v => v.identifier),\n          backgroundColor: identifiersConfig.map(\n            config => config.backgroundColor\n          )\n        }\n      ]\n    };\n    if (this.chart) {\n      this.chart.data = this.barChartData;\n      this.chart.update();\n    }\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { PieChartComponent } from './pie-chart.component';\n\n@NgModule({\n  declarations: [PieChartComponent],\n  exports: [PieChartComponent],\n  imports: [CommonModule]\n})\nexport class PieChartModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}