{"version":3,"file":"sofico-framework-ui-kit-components-line-chart.js","sources":["../../../../projects/sofico-framework/ui-kit/components/line-chart/line-chart.component.ts","../../../../projects/sofico-framework/ui-kit/components/line-chart/line-chart.module.ts","../../../../projects/sofico-framework/ui-kit/components/line-chart/sofico-framework-ui-kit-components-line-chart.ts"],"sourcesContent":["import {\n  AfterViewInit,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport {\n  ChartIdentifierConfig,\n  MultiValueChartValue\n} from '@sofico-framework/ui-kit/types';\nimport { Chart } from 'chart.js';\nimport { flatten } from 'lodash';\nimport { Changes, takeUntilDestroy, UntilDestroy } from 'ngx-reactivetoolkit';\nimport { combineLatest } from 'rxjs';\n\n@UntilDestroy()\n@Component({\n  selector: 'sof-line-chart',\n  template: `\n    <div class=\"chart-container\" style=\"position: relative; width:100%\">\n      <canvas #chart></canvas>\n    </div>\n  `,\n  styleUrls: ['./line-chart.component.scss']\n})\nexport class LineChartComponent\n  implements OnDestroy, OnChanges, OnInit, AfterViewInit {\n  private chart: Chart;\n  @ViewChild('chart', { static: true })\n  chartElem: ElementRef<HTMLCanvasElement>;\n\n  lineChartData: any;\n  @Input() tooltipFn: (\n    xLabel: string,\n    itemLabel: string,\n    yValue: number,\n    identifier?: string\n  ) => string;\n  @Input() identifiersConfig: ChartIdentifierConfig[];\n  @Input() suggestedMin: number;\n  @Input() suggestedMax: number;\n  @Input() chartData: MultiValueChartValue[];\n  @Changes('identifiersConfig') identifiersConfig$;\n  @Changes('chartData') chartData$;\n\n  constructor(private cdRef: ChangeDetectorRef) {\n    this.cdRef.detach();\n  }\n\n  ngOnInit(): void {\n    combineLatest([this.identifiersConfig$, this.chartData$])\n      .pipe(takeUntilDestroy(this))\n      .subscribe(([identifiersConfig, values]) => {\n        this.setData(\n          identifiersConfig as ChartIdentifierConfig[],\n          values as MultiValueChartValue[]\n        );\n      });\n  }\n\n  ngOnChanges(): void {}\n\n  ngOnDestroy(): void {\n    this?.chart?.destroy();\n  }\n\n  ngAfterViewInit(): void {\n    const ctx = this.chartElem.nativeElement.getContext('2d');\n    this.chart = new Chart(ctx, {\n      type: 'line',\n      data: this.lineChartData,\n      options: {\n        tooltips: {\n          callbacks: {\n            label: (tooltipItem, data) => {\n              if (this.tooltipFn) {\n                const stackItemLabel =\n                  data.datasets[tooltipItem.datasetIndex].label || '';\n                return this.tooltipFn(\n                  tooltipItem.xLabel as string,\n                  stackItemLabel,\n                  tooltipItem.value as any,\n                  (data.datasets[tooltipItem.datasetIndex] as any).identifier\n                );\n              }\n            }\n          }\n        },\n        aspectRatio: 1,\n        responsive: true,\n        legend: {\n          align: 'start',\n          rtl: true\n        } as any,\n        scales: {\n          yAxes: [\n            {\n              display: true,\n              ticks: {\n                suggestedMax: this.suggestedMax,\n                suggestedMin: this.suggestedMin || 0\n              }\n            }\n          ]\n        }\n      }\n    });\n  }\n\n  private setData(\n    identifiersConfig: ChartIdentifierConfig[],\n    values: MultiValueChartValue[]\n  ): void {\n    if (!values || !identifiersConfig) {\n      return;\n    }\n    const labels = values.map(v => v?.xLabel);\n    const identifiers = [\n      ...new Set(\n        flatten(values.map(v => v.yValues.map(yValue => yValue.identifier)))\n      )\n    ];\n    const datasets = identifiers.map(identifier => {\n      const config = identifiersConfig.find(\n        item => item.identifier === identifier\n      );\n      return {\n        label: config?.label,\n        fill: false,\n        identifier,\n        lineTension: 0.1,\n        pointBorderWidth: 4,\n        backgroundColor: config?.backgroundColor,\n        borderColor: config?.backgroundColor,\n        data: values.map(\n          value =>\n            value.yValues.find(yValue => yValue.identifier === identifier)\n              ?.value\n        )\n      };\n    });\n    this.lineChartData = {\n      labels,\n      datasets\n    };\n    if (this.chart) {\n      this.chart.data = this.lineChartData;\n      this.chart.update();\n    }\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { LineChartComponent } from './line-chart.component';\n\n@NgModule({\n  declarations: [LineChartComponent],\n  exports: [LineChartComponent],\n  imports: [CommonModule]\n})\nexport class LineChartModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}