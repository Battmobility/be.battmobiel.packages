{"version":3,"file":"sofico-framework-ui-kit-components-drop-file-area.js","sources":["../../../../projects/sofico-framework/ui-kit/components/drop-file-area/drop-file-area.component.ts","../../../../projects/sofico-framework/ui-kit/components/drop-file-area/drop-file-area.module.ts","../../../../projects/sofico-framework/ui-kit/components/drop-file-area/sofico-framework-ui-kit-components-drop-file-area.ts"],"sourcesContent":["import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport { FileSelectionService } from '@sofico-framework/utils';\nimport { takeUntilDestroy, UntilDestroy } from 'ngx-reactivetoolkit';\nimport { EMPTY, fromEvent, merge, Observable, timer } from 'rxjs';\nimport {\n  debounce,\n  distinctUntilChanged,\n  filter,\n  map,\n  mapTo,\n  tap\n} from 'rxjs/operators';\n\n@UntilDestroy()\n@Component({\n  selector: 'sof-drop-file-area',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  styleUrls: ['./drop-file-area.component.scss'],\n  template: `\n    <div #dropArea class=\"drop-area p-3\" [class.highlight]=\"highlight$ | async\">\n      <h4 class=\"mt-2\">\n        <sof-svg-icon icon=\"icon-file-empty\" size=\"24\"></sof-svg-icon>\n        {{ dragAndDropText }}\n        <a href=\"javascript:void(0)\" (click)=\"showFileSelect()\">{{\n          browseFilesLinkText\n        }}</a>\n      </h4>\n      <p>\n        <ng-container *ngIf=\"!multipleFiles\">\n          {{ singleFileWarningMsg }}<br />\n        </ng-container>\n        <ng-content></ng-content>\n      </p>\n    </div>\n  `\n})\nexport class DropFileAreaComponent implements AfterViewInit, OnInit, OnDestroy {\n  @Input() tc: string;\n  @Input() dragAndDropText: string;\n  @Input() browseFilesLinkText: string;\n  @Input() singleFileWarningMsg: string;\n  @Input() multipleFiles = true;\n  /**\n   * The default accepted MIME types are pdf, jpeg and png.\n   */\n  @Input() acceptedMimeTypes: string[] = [\n    'application/pdf',\n    'image/jpeg',\n    'image/x-png'\n  ];\n  @Output() addedFiles = new EventEmitter<FileList>();\n\n  @ViewChild('dropArea', { static: true })\n  dropArea: ElementRef;\n\n  dropAreaDropEvent$: Observable<DragEvent>;\n  dropAreaDragEnterEvent$: Observable<DragEvent>;\n  dropAreaDragOverEvent$: Observable<DragEvent>;\n  dropAreaDragLeaveEvent$: Observable<DragEvent>;\n\n  highlight$: Observable<boolean>;\n\n  droppedFiles$: Observable<FileList>;\n\n  constructor(private fileSelectionService: FileSelectionService) {}\n\n  ngOnDestroy(): void {}\n\n  ngOnInit(): void {\n    this.dropAreaDropEvent$ = this.getDropEvent$(\n      this.dropArea.nativeElement,\n      'drop'\n    );\n    this.dropAreaDragEnterEvent$ = this.getDropEvent$(\n      this.dropArea.nativeElement,\n      'dragenter'\n    );\n    this.dropAreaDragOverEvent$ = this.getDropEvent$(\n      this.dropArea.nativeElement,\n      'dragover'\n    );\n    this.dropAreaDragLeaveEvent$ = this.getDropEvent$(\n      this.dropArea.nativeElement,\n      'dragleave'\n    );\n\n    this.highlight$ = this.getHighlight$();\n\n    this.droppedFiles$ = this.getDroppedFiles$();\n  }\n\n  ngAfterViewInit(): void {\n    if (this.multipleFiles) {\n      this.droppedFiles$.pipe(takeUntilDestroy(this)).subscribe(fileList => {\n        this.addedFiles.emit(fileList);\n      });\n    } else {\n      this.droppedFiles$\n        .pipe(\n          filter(fileList => fileList?.length <= 1),\n          takeUntilDestroy(this)\n        )\n        .subscribe(fileList => {\n          this.addedFiles.emit(fileList);\n        });\n    }\n  }\n\n  showFileSelect(): void {\n    this.fileSelectionService\n      .getFileSelector(this.acceptedMimeTypes, this.multipleFiles)\n      .pipe(takeUntilDestroy(this))\n      .subscribe(fileList => this.addedFiles.emit(fileList));\n  }\n\n  private getDroppedFiles$(): Observable<FileList> {\n    return this.dropAreaDropEvent$.pipe(\n      map((e: DragEvent) => e.dataTransfer.files),\n      filter(files =>\n        Array.from(files).every(file =>\n          this.acceptedMimeTypes.includes(file.type)\n        )\n      )\n    );\n  }\n\n  private getHighlight$(): Observable<boolean> {\n    return merge(\n      merge(this.dropAreaDragEnterEvent$, this.dropAreaDragOverEvent$).pipe(\n        mapTo(true)\n      ),\n      merge(this.dropAreaDropEvent$, this.dropAreaDragLeaveEvent$).pipe(\n        mapTo(false)\n      )\n    ).pipe(\n      // This delays un-highlighting the drop zone,\n      // first added as a fix to eliminate flickering by dragLeave Events\n      distinctUntilChanged(),\n      debounce(startDevice => (startDevice ? EMPTY : timer(100))),\n      distinctUntilChanged()\n    );\n  }\n\n  private getDropEvent$(\n    elementRef: any,\n    eventName:\n      | 'drag'\n      | 'dragend'\n      | 'dragenter'\n      | 'dragexit'\n      | 'dragleave'\n      | 'dragover'\n      | 'dragstart'\n      | 'drop'\n  ): Observable<DragEvent> {\n    return fromEvent(elementRef, eventName).pipe(\n      tap((e: Event) => {\n        e.preventDefault();\n        e.stopPropagation();\n      })\n    ) as Observable<DragEvent>;\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { SvgIconModule } from '@sofico-framework/ui-kit/components/svg-icon';\nimport { DropFileAreaComponent } from './drop-file-area.component';\n\n@NgModule({\n  declarations: [DropFileAreaComponent],\n  exports: [DropFileAreaComponent],\n  imports: [CommonModule, SvgIconModule]\n})\nexport class DropFileAreaModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}