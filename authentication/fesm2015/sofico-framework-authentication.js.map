{"version":3,"file":"sofico-framework-authentication.js","sources":["../../../../projects/sofico-framework/authentication/src/lib/services/authenticated-result.service.ts","../../../../projects/sofico-framework/authentication/src/lib/services/authentication.service.ts","../../../../projects/sofico-framework/authentication/src/lib/guards/authenticated.guard.ts","../../../../projects/sofico-framework/authentication/src/lib/guards/guest.guard.ts","../../../../projects/sofico-framework/authentication/src/lib/interceptors/custom-oauth.interceptor.ts","../../../../projects/sofico-framework/authentication/src/lib/interceptors/resource-server-auto-logout-error-handler.ts","../../../../projects/sofico-framework/authentication/src/lib/stores/session-storage-oauth.store.ts","../../../../projects/sofico-framework/authentication/src/lib/authentication.module.ts","../../../../projects/sofico-framework/authentication/src/public-api.ts","../../../../projects/sofico-framework/authentication/src/sofico-framework-authentication.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Observable, ReplaySubject } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\n@Injectable()\nexport class AuthenticatedResultService {\n  private _authenticatedResult$ = new ReplaySubject<boolean>(1);\n\n  get authenticatedResult$(): Observable<boolean> {\n    return this._authenticatedResult$\n      .asObservable()\n      .pipe(distinctUntilChanged());\n  }\n\n  setAuthenticatedResult(value: boolean): void {\n    this._authenticatedResult$.next(value);\n  }\n}\n","import { PlatformLocation } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Config, ConfigService } from '@sofico-framework/app-config';\nimport { WindowRefService } from '@sofico-framework/utils';\nimport { OAuthService } from 'angular-oauth2-oidc';\nimport { JwksValidationHandler } from 'angular-oauth2-oidc-jwks';\nimport { filter, take } from 'rxjs/operators';\nimport { AuthenticatedResultService } from './authenticated-result.service';\n\n@Injectable()\nexport class AuthenticationService {\n  private readonly location: Location = this.windowRefService.nativeWindow\n    .location;\n  private readonly baseHref =\n    this.location.origin + this.platformLocation.getBaseHrefFromDOM();\n\n  constructor(\n    private httpClient: HttpClient,\n    private windowRefService: WindowRefService,\n    private oauthService: OAuthService,\n    private router: Router,\n    private configService: ConfigService,\n    private authenticatedResultService: AuthenticatedResultService,\n    private platformLocation: PlatformLocation\n  ) {\n    if (this.configService.config.auth.grant === 'implicit') {\n      this.configureLoginWithSSO();\n      this.listenOnErrorReceivedAndLogout();\n    } else {\n      throw new Error('unsupported authentication grant');\n    }\n  }\n\n  loginWithSingleSignOn(): void {\n    this.oauthService.initImplicitFlow();\n  }\n\n  logout(pathBasedRedirectUri: boolean = false): void {\n    this.oauthService.redirectUri = this.calculateRedirectUri(\n      pathBasedRedirectUri\n    );\n    this.oauthService.logOut();\n  }\n\n  logoutWithoutRedirect(): void {\n    this.oauthService.logOut(true);\n  }\n\n  setPostLogoutRedirectUri(uri: string): void {\n    this.oauthService.postLogoutRedirectUri = uri;\n  }\n\n  private configureLoginWithSSO(): void {\n    const languageParam = this.getLanguageParam();\n\n    const authConfig = {\n      clientId: this.configService.config.auth.clientId,\n      issuer: this.calculateIssuer(this.configService.config),\n      redirectUri: this.calculateRedirectUri(true),\n      silentRefreshRedirectUri: this.baseHref + 'silent-refresh.html',\n      postLogoutRedirectUri: this.baseHref\n    };\n    this.oauthService.configure(authConfig);\n\n    if (languageParam) {\n      this.oauthService.customQueryParams = {\n        // kc_locale because it set a cookie automatically\n        // that contains the language parameter so it's saved\n        // when you refresh and wait to long before you take an action\n        kc_locale: languageParam\n      };\n    }\n\n    this.oauthService.tokenValidationHandler = new JwksValidationHandler();\n    this.oauthService\n      .loadDiscoveryDocumentAndTryLogin()\n      .then(() =>\n        this.authenticatedResultService.setAuthenticatedResult(\n          this.oauthService.hasValidIdToken()\n        )\n      )\n      .catch(() =>\n        this.authenticatedResultService.setAuthenticatedResult(false)\n      );\n    this.oauthService.setupAutomaticSilentRefresh();\n  }\n\n  private calculateRedirectUri(pathBasedRedirectUri: boolean): string {\n    const { protocol, host, pathname, search } = this.location;\n    return `${protocol}//${host}${\n      pathBasedRedirectUri ? pathname + search : ''\n    }`;\n  }\n\n  private calculateIssuer(config: Config): string {\n    return config.auth.baseUrl + config.auth.realm;\n  }\n\n  private listenOnErrorReceivedAndLogout(): void {\n    this.oauthService.events\n      .pipe(\n        filter(\n          event =>\n            event.type === 'silent_refresh_error' ||\n            event.type === 'token_error'\n        ),\n        take(1)\n      )\n      .subscribe(() => this.logout(true));\n  }\n\n  private getLanguageParam(): string {\n    // the reason why we're using windowRefService instead of activatedRouter\n    // to get the router params is because activatedRouter params has no value.\n    // This is because there is no NavigationEnd event on Router\n    const queryString = this.windowRefService.nativeWindow.location.search;\n    const urlParams = new URLSearchParams(queryString);\n\n    return urlParams.get('ui_locales');\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CanActivate } from '@angular/router';\nimport { Observable } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { AuthenticatedResultService } from '../services/authenticated-result.service';\nimport { AuthenticationService } from '../services/authentication.service';\n\n@Injectable()\nexport class AuthenticatedGuard implements CanActivate {\n  constructor(\n    private authenticationService: AuthenticationService,\n    private authenticatedResultService: AuthenticatedResultService\n  ) {}\n\n  canActivate(): Observable<boolean> {\n    return this.authenticatedResultService.authenticatedResult$.pipe(\n      tap((authenticated: boolean) => {\n        if (!authenticated) {\n          this.authenticationService.loginWithSingleSignOn();\n        }\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CanActivate, Router } from '@angular/router';\nimport { ConfigService } from '@sofico-framework/app-config';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { AuthenticatedResultService } from '../services/authenticated-result.service';\nimport { AuthenticationService } from '../services/authentication.service';\n\n@Injectable()\nexport class GuestGuard implements CanActivate {\n  constructor(\n    private authenticationService: AuthenticationService,\n    private authenticatedResultService: AuthenticatedResultService,\n    private configService: ConfigService,\n    private router: Router\n  ) {}\n\n  canActivate(): Observable<boolean> {\n    return this.authenticatedResultService.authenticatedResult$.pipe(\n      map((authenticated: boolean) => {\n        if (authenticated) {\n          this.router.navigate(['/']);\n          return false;\n        } else {\n          if (this.configService.config.auth.grant === 'implicit') {\n            this.authenticationService.loginWithSingleSignOn();\n            return false;\n          }\n        }\n        return !authenticated;\n      })\n    );\n  }\n}\n","import {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { ConfigService } from '@sofico-framework/app-config';\nimport {\n  OAuthResourceServerErrorHandler,\n  OAuthStorage\n} from 'angular-oauth2-oidc';\nimport { Observable } from 'rxjs';\nimport { catchError, filter, mergeMap, take } from 'rxjs/operators';\nimport { AuthenticatedResultService } from '../services/authenticated-result.service';\n\n@Injectable()\nexport class CustomOAuthInterceptor implements HttpInterceptor {\n  constructor(\n    private authStorage: OAuthStorage,\n    private errorHandler: OAuthResourceServerErrorHandler,\n    private configService: ConfigService,\n    private authenticatedResultService: AuthenticatedResultService\n  ) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const url = req.url.toLowerCase();\n\n    if (!this.configService.config) {\n      return next.handle(req);\n    }\n\n    if (!this.configService.config.auth) {\n      return next.handle(req);\n    }\n\n    if (!this.configService.config.auth.allowedUrls) {\n      return next.handle(req);\n    }\n\n    if (!this.checkUrl(url, this.configService.config.auth.allowedUrls)) {\n      return next.handle(req);\n    }\n\n    return this.authenticatedResultService.authenticatedResult$.pipe(\n      take(1),\n      filter(v => !!v),\n      mergeMap(() => {\n        const token = this.authStorage.getItem('access_token');\n        const header = 'Bearer ' + token;\n        const headers = req.headers.set('Authorization', header);\n        req = req.clone({ headers });\n        return next.handle(req);\n      }),\n      catchError(err => this.errorHandler.handleError(err)) as any\n    );\n  }\n\n  private checkUrl(url: string, allowedUrls: string[]): boolean {\n    const found = allowedUrls.find(u => url.startsWith(u));\n    return !!found;\n  }\n}\n","import { HttpResponse } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { WindowRefService } from '@sofico-framework/utils';\nimport {\n  OAuthResourceServerErrorHandler,\n  OAuthService\n} from 'angular-oauth2-oidc';\nimport { EMPTY, Observable, throwError } from 'rxjs';\n\n@Injectable()\nexport class ResourceServerAutoLogoutErrorHandler\n  implements OAuthResourceServerErrorHandler {\n  private readonly location: Location = this.windowRefService.nativeWindow\n    .location;\n\n  constructor(\n    private oauthService: OAuthService,\n    private windowRefService: WindowRefService\n  ) {}\n\n  handleError(err: HttpResponse<any>): Observable<any> {\n    if (err.status === 401) {\n      this.logout(true);\n      return EMPTY;\n    } else {\n      return throwError(err);\n    }\n  }\n\n  private logout(pathBasedRedirectUri: boolean): void {\n    this.oauthService.redirectUri = this.calculateRedirectUri(\n      pathBasedRedirectUri\n    );\n    this.oauthService.logOut();\n  }\n\n  private calculateRedirectUri(pathBasedRedirectUri: boolean): string {\n    const { protocol, host, pathname, search } = this.location;\n    return `${protocol}//${host}${\n      pathBasedRedirectUri ? pathname + search : ''\n    }`;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ConfigService } from '@sofico-framework/app-config';\nimport { WindowRefService } from '@sofico-framework/utils';\nimport { OAuthStorage } from 'angular-oauth2-oidc';\n\n@Injectable()\nexport class SessionStorageOAuthStore implements OAuthStorage {\n  private readonly prefix = this.configService.config.auth.clientId;\n  private readonly storage = this.windowRefService.nativeWindow.sessionStorage;\n\n  constructor(\n    private configService: ConfigService,\n    private windowRefService: WindowRefService\n  ) {}\n\n  getItem(key: string): string | null {\n    return this.storage.getItem(this.calculateKey(key));\n  }\n\n  removeItem(key: string): void {\n    this.storage.removeItem(this.calculateKey(key));\n  }\n\n  setItem(key: string, data: string): void {\n    this.storage.setItem(this.calculateKey(key), data);\n  }\n\n  private calculateKey(key: string): string {\n    return `${this.prefix}_${key}`;\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { HTTP_INTERCEPTORS, HttpClientModule } from '@angular/common/http';\nimport { NgModule, Optional, SkipSelf } from '@angular/core';\nimport { ConfigService } from '@sofico-framework/app-config';\nimport { WindowRefService } from '@sofico-framework/utils';\nimport {\n  OAuthModule,\n  OAuthResourceServerErrorHandler,\n  OAuthStorage\n} from 'angular-oauth2-oidc';\nimport { AuthenticatedGuard } from './guards/authenticated.guard';\nimport { GuestGuard } from './guards/guest.guard';\nimport { CustomOAuthInterceptor } from './interceptors/custom-oauth.interceptor';\nimport { ResourceServerAutoLogoutErrorHandler } from './interceptors/resource-server-auto-logout-error-handler';\nimport { AuthenticatedResultService } from './services/authenticated-result.service';\n\nimport { AuthenticationService } from './services/authentication.service';\nimport { SessionStorageOAuthStore } from './stores/session-storage-oauth.store';\n\n@NgModule({\n  imports: [CommonModule, OAuthModule.forRoot()],\n  declarations: [],\n  providers: [\n    AuthenticationService,\n    AuthenticatedResultService,\n    AuthenticatedGuard,\n    GuestGuard,\n    {\n      provide: HTTP_INTERCEPTORS,\n      useClass: CustomOAuthInterceptor,\n      multi: true\n    },\n    {\n      provide: OAuthStorage,\n      useClass: SessionStorageOAuthStore\n    },\n    {\n      provide: OAuthResourceServerErrorHandler,\n      useClass: ResourceServerAutoLogoutErrorHandler\n    }\n  ]\n})\nexport class AuthenticationModule {\n  constructor(\n    @Optional() @SkipSelf() parentModule: AuthenticationModule,\n    @Optional() windowRefService: WindowRefService,\n    @Optional() httpClient: HttpClientModule,\n    @Optional() configService: ConfigService\n  ) {\n    if (parentModule) {\n      throw new Error(\n        'AuthenticationModule is already loaded. Import in your base AppModule only.'\n      );\n    }\n    if (!windowRefService) {\n      throw new Error(\n        'You need to import the UtilServicesModule in your AppModule!'\n      );\n    }\n    if (!httpClient) {\n      throw new Error(\n        'You need to import the HttpClientModule in your AppModule!'\n      );\n    }\n    if (!configService) {\n      throw new Error(\n        'You need to import the AppConfigModule in your AppModule!'\n      );\n    }\n  }\n}\n","/*\n * Public API Surface of authentication\n */\n\n// guards\nexport * from './lib/guards/authenticated.guard';\nexport * from './lib/guards/guest.guard';\n\n// interceptors\nexport * from './lib/interceptors/custom-oauth.interceptor';\nexport * from './lib/interceptors/resource-server-auto-logout-error-handler';\n\n// services\nexport * from './lib/services/authenticated-result.service';\nexport * from './lib/services/authentication.service';\n\n// stores\nexport * from './lib/stores/session-storage-oauth.store';\n\n// types\nexport * from './lib/types/activation-code.type';\nexport * from './lib/types/activation-code-request.type';\nexport * from './lib/types/activation-code-result.type';\nexport * from './lib/types/authentication-result.type';\nexport * from './lib/types/authentication-config.type';\n\n// modules\nexport * from './lib/authentication.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":";;;;;;;;;;;MAKa,0BAA0B;IADvC;QAEU,0BAAqB,GAAG,IAAI,aAAa,CAAU,CAAC,CAAC,CAAC;KAW/D;IATC,IAAI,oBAAoB;QACtB,OAAO,IAAI,CAAC,qBAAqB;aAC9B,YAAY,EAAE;aACd,IAAI,CAAC,oBAAoB,EAAE,CAAC,CAAC;KACjC;IAED,sBAAsB,CAAC,KAAc;QACnC,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;KACxC;;;YAZF,UAAU;;;MCQE,qBAAqB;IAMhC,YACU,UAAsB,EACtB,gBAAkC,EAClC,YAA0B,EAC1B,MAAc,EACd,aAA4B,EAC5B,0BAAsD,EACtD,gBAAkC;QANlC,eAAU,GAAV,UAAU,CAAY;QACtB,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,iBAAY,GAAZ,YAAY,CAAc;QAC1B,WAAM,GAAN,MAAM,CAAQ;QACd,kBAAa,GAAb,aAAa,CAAe;QAC5B,+BAA0B,GAA1B,0BAA0B,CAA4B;QACtD,qBAAgB,GAAhB,gBAAgB,CAAkB;QAZ3B,aAAQ,GAAa,IAAI,CAAC,gBAAgB,CAAC,YAAY;aACrE,QAAQ,CAAC;QACK,aAAQ,GACvB,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,CAAC;QAWlE,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,KAAK,UAAU,EAAE;YACvD,IAAI,CAAC,qBAAqB,EAAE,CAAC;YAC7B,IAAI,CAAC,8BAA8B,EAAE,CAAC;SACvC;aAAM;YACL,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;SACrD;KACF;IAED,qBAAqB;QACnB,IAAI,CAAC,YAAY,CAAC,gBAAgB,EAAE,CAAC;KACtC;IAED,MAAM,CAAC,uBAAgC,KAAK;QAC1C,IAAI,CAAC,YAAY,CAAC,WAAW,GAAG,IAAI,CAAC,oBAAoB,CACvD,oBAAoB,CACrB,CAAC;QACF,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;KAC5B;IAED,qBAAqB;QACnB,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KAChC;IAED,wBAAwB,CAAC,GAAW;QAClC,IAAI,CAAC,YAAY,CAAC,qBAAqB,GAAG,GAAG,CAAC;KAC/C;IAEO,qBAAqB;QAC3B,MAAM,aAAa,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAE9C,MAAM,UAAU,GAAG;YACjB,QAAQ,EAAE,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ;YACjD,MAAM,EAAE,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC;YACvD,WAAW,EAAE,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC;YAC5C,wBAAwB,EAAE,IAAI,CAAC,QAAQ,GAAG,qBAAqB;YAC/D,qBAAqB,EAAE,IAAI,CAAC,QAAQ;SACrC,CAAC;QACF,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;QAExC,IAAI,aAAa,EAAE;YACjB,IAAI,CAAC,YAAY,CAAC,iBAAiB,GAAG;;;;gBAIpC,SAAS,EAAE,aAAa;aACzB,CAAC;SACH;QAED,IAAI,CAAC,YAAY,CAAC,sBAAsB,GAAG,IAAI,qBAAqB,EAAE,CAAC;QACvE,IAAI,CAAC,YAAY;aACd,gCAAgC,EAAE;aAClC,IAAI,CAAC,MACJ,IAAI,CAAC,0BAA0B,CAAC,sBAAsB,CACpD,IAAI,CAAC,YAAY,CAAC,eAAe,EAAE,CACpC,CACF;aACA,KAAK,CAAC,MACL,IAAI,CAAC,0BAA0B,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAC9D,CAAC;QACJ,IAAI,CAAC,YAAY,CAAC,2BAA2B,EAAE,CAAC;KACjD;IAEO,oBAAoB,CAAC,oBAA6B;QACxD,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC3D,OAAO,GAAG,QAAQ,KAAK,IAAI,GACzB,oBAAoB,GAAG,QAAQ,GAAG,MAAM,GAAG,EAC7C,EAAE,CAAC;KACJ;IAEO,eAAe,CAAC,MAAc;QACpC,OAAO,MAAM,CAAC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC;KAChD;IAEO,8BAA8B;QACpC,IAAI,CAAC,YAAY,CAAC,MAAM;aACrB,IAAI,CACH,MAAM,CACJ,KAAK,IACH,KAAK,CAAC,IAAI,KAAK,sBAAsB;YACrC,KAAK,CAAC,IAAI,KAAK,aAAa,CAC/B,EACD,IAAI,CAAC,CAAC,CAAC,CACR;aACA,SAAS,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;KACvC;IAEO,gBAAgB;;;;QAItB,MAAM,WAAW,GAAG,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,QAAQ,CAAC,MAAM,CAAC;QACvE,MAAM,SAAS,GAAG,IAAI,eAAe,CAAC,WAAW,CAAC,CAAC;QAEnD,OAAO,SAAS,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;KACpC;;;YA9GF,UAAU;;;YAVF,UAAU;YAIV,gBAAgB;YAChB,YAAY;YAHZ,MAAM;YACE,aAAa;YAKrB,0BAA0B;YAT1B,gBAAgB;;;MCQZ,kBAAkB;IAC7B,YACU,qBAA4C,EAC5C,0BAAsD;QADtD,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,+BAA0B,GAA1B,0BAA0B,CAA4B;KAC5D;IAEJ,WAAW;QACT,OAAO,IAAI,CAAC,0BAA0B,CAAC,oBAAoB,CAAC,IAAI,CAC9D,GAAG,CAAC,CAAC,aAAsB;YACzB,IAAI,CAAC,aAAa,EAAE;gBAClB,IAAI,CAAC,qBAAqB,CAAC,qBAAqB,EAAE,CAAC;aACpD;SACF,CAAC,CACH,CAAC;KACH;;;YAfF,UAAU;;;YAFF,qBAAqB;YADrB,0BAA0B;;;MCKtB,UAAU;IACrB,YACU,qBAA4C,EAC5C,0BAAsD,EACtD,aAA4B,EAC5B,MAAc;QAHd,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,+BAA0B,GAA1B,0BAA0B,CAA4B;QACtD,kBAAa,GAAb,aAAa,CAAe;QAC5B,WAAM,GAAN,MAAM,CAAQ;KACpB;IAEJ,WAAW;QACT,OAAO,IAAI,CAAC,0BAA0B,CAAC,oBAAoB,CAAC,IAAI,CAC9D,GAAG,CAAC,CAAC,aAAsB;YACzB,IAAI,aAAa,EAAE;gBACjB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;gBAC5B,OAAO,KAAK,CAAC;aACd;iBAAM;gBACL,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,KAAK,UAAU,EAAE;oBACvD,IAAI,CAAC,qBAAqB,CAAC,qBAAqB,EAAE,CAAC;oBACnD,OAAO,KAAK,CAAC;iBACd;aACF;YACD,OAAO,CAAC,aAAa,CAAC;SACvB,CAAC,CACH,CAAC;KACH;;;YAxBF,UAAU;;;YAFF,qBAAqB;YADrB,0BAA0B;YAH1B,aAAa;YADA,MAAM;;;MCgBf,sBAAsB;IACjC,YACU,WAAyB,EACzB,YAA6C,EAC7C,aAA4B,EAC5B,0BAAsD;QAHtD,gBAAW,GAAX,WAAW,CAAc;QACzB,iBAAY,GAAZ,YAAY,CAAiC;QAC7C,kBAAa,GAAb,aAAa,CAAe;QAC5B,+BAA0B,GAA1B,0BAA0B,CAA4B;KAC5D;IAEJ,SAAS,CACP,GAAqB,EACrB,IAAiB;QAEjB,MAAM,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC;QAElC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE;YAC9B,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;QAED,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,EAAE;YACnC,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;QAED,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE;YAC/C,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;QAED,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE;YACnE,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;QAED,OAAO,IAAI,CAAC,0BAA0B,CAAC,oBAAoB,CAAC,IAAI,CAC9D,IAAI,CAAC,CAAC,CAAC,EACP,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAChB,QAAQ,CAAC;YACP,MAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;YACvD,MAAM,MAAM,GAAG,SAAS,GAAG,KAAK,CAAC;YACjC,MAAM,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;YACzD,GAAG,GAAG,GAAG,CAAC,KAAK,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;YAC7B,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB,CAAC,EACF,UAAU,CAAC,GAAG,IAAI,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,GAAG,CAAC,CAAQ,CAC7D,CAAC;KACH;IAEO,QAAQ,CAAC,GAAW,EAAE,WAAqB;QACjD,MAAM,KAAK,GAAG,WAAW,CAAC,IAAI,CAAC,CAAC,IAAI,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;QACvD,OAAO,CAAC,CAAC,KAAK,CAAC;KAChB;;;YAhDF,UAAU;;;YANT,YAAY;YADZ,+BAA+B;YAFxB,aAAa;YAOb,0BAA0B;;;MCJtB,oCAAoC;IAK/C,YACU,YAA0B,EAC1B,gBAAkC;QADlC,iBAAY,GAAZ,YAAY,CAAc;QAC1B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAL3B,aAAQ,GAAa,IAAI,CAAC,gBAAgB,CAAC,YAAY;aACrE,QAAQ,CAAC;KAKR;IAEJ,WAAW,CAAC,GAAsB;QAChC,IAAI,GAAG,CAAC,MAAM,KAAK,GAAG,EAAE;YACtB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAClB,OAAO,KAAK,CAAC;SACd;aAAM;YACL,OAAO,UAAU,CAAC,GAAG,CAAC,CAAC;SACxB;KACF;IAEO,MAAM,CAAC,oBAA6B;QAC1C,IAAI,CAAC,YAAY,CAAC,WAAW,GAAG,IAAI,CAAC,oBAAoB,CACvD,oBAAoB,CACrB,CAAC;QACF,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;KAC5B;IAEO,oBAAoB,CAAC,oBAA6B;QACxD,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC3D,OAAO,GAAG,QAAQ,KAAK,IAAI,GACzB,oBAAoB,GAAG,QAAQ,GAAG,MAAM,GAAG,EAC7C,EAAE,CAAC;KACJ;;;YAhCF,UAAU;;;YAJT,YAAY;YAHL,gBAAgB;;;MCIZ,wBAAwB;IAInC,YACU,aAA4B,EAC5B,gBAAkC;QADlC,kBAAa,GAAb,aAAa,CAAe;QAC5B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAL3B,WAAM,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;QACjD,YAAO,GAAG,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,cAAc,CAAC;KAKzE;IAEJ,OAAO,CAAC,GAAW;QACjB,OAAO,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC;KACrD;IAED,UAAU,CAAC,GAAW;QACpB,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC;KACjD;IAED,OAAO,CAAC,GAAW,EAAE,IAAY;QAC/B,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;KACpD;IAEO,YAAY,CAAC,GAAW;QAC9B,OAAO,GAAG,IAAI,CAAC,MAAM,IAAI,GAAG,EAAE,CAAC;KAChC;;;YAxBF,UAAU;;;YAJF,aAAa;YACb,gBAAgB;;;MCwCZ,oBAAoB;IAC/B,YAC0B,YAAkC,EAC9C,gBAAkC,EAClC,UAA4B,EAC5B,aAA4B;QAExC,IAAI,YAAY,EAAE;YAChB,MAAM,IAAI,KAAK,CACb,6EAA6E,CAC9E,CAAC;SACH;QACD,IAAI,CAAC,gBAAgB,EAAE;YACrB,MAAM,IAAI,KAAK,CACb,8DAA8D,CAC/D,CAAC;SACH;QACD,IAAI,CAAC,UAAU,EAAE;YACf,MAAM,IAAI,KAAK,CACb,4DAA4D,CAC7D,CAAC;SACH;QACD,IAAI,CAAC,aAAa,EAAE;YAClB,MAAM,IAAI,KAAK,CACb,2DAA2D,CAC5D,CAAC;SACH;KACF;;;YAlDF,QAAQ,SAAC;gBACR,OAAO,EAAE,CAAC,YAAY,EAAE,WAAW,CAAC,OAAO,EAAE,CAAC;gBAC9C,YAAY,EAAE,EAAE;gBAChB,SAAS,EAAE;oBACT,qBAAqB;oBACrB,0BAA0B;oBAC1B,kBAAkB;oBAClB,UAAU;oBACV;wBACE,OAAO,EAAE,iBAAiB;wBAC1B,QAAQ,EAAE,sBAAsB;wBAChC,KAAK,EAAE,IAAI;qBACZ;oBACD;wBACE,OAAO,EAAE,YAAY;wBACrB,QAAQ,EAAE,wBAAwB;qBACnC;oBACD;wBACE,OAAO,EAAE,+BAA+B;wBACxC,QAAQ,EAAE,oCAAoC;qBAC/C;iBACF;aACF;;;YAGyC,oBAAoB,uBAAzD,QAAQ,YAAI,QAAQ;YAxChB,gBAAgB,uBAyCpB,QAAQ;YA5Ce,gBAAgB,uBA6CvC,QAAQ;YA3CJ,aAAa,uBA4CjB,QAAQ;;;AC/Cb;;;;ACAA;;;;;;"}