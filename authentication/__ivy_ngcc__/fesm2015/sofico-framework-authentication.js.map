{"version":3,"file":"sofico-framework-authentication.js","sources":["../../../../projects/sofico-framework/authentication/src/lib/services/authenticated-result.service.ts","../../../../projects/sofico-framework/authentication/src/lib/services/authentication.service.ts","../../../../projects/sofico-framework/authentication/src/lib/guards/authenticated.guard.ts","../../../../projects/sofico-framework/authentication/src/lib/guards/guest.guard.ts","../../../../projects/sofico-framework/authentication/src/lib/interceptors/custom-oauth.interceptor.ts","../../../../projects/sofico-framework/authentication/src/lib/interceptors/resource-server-auto-logout-error-handler.ts","../../../../projects/sofico-framework/authentication/src/lib/stores/session-storage-oauth.store.ts","../../../../projects/sofico-framework/authentication/src/lib/authentication.module.ts","../../../../projects/sofico-framework/authentication/src/public-api.ts","../../../../projects/sofico-framework/authentication/src/sofico-framework-authentication.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;MAKa,0BAA0B;AACvC,IAFA;AACE,QACQ,0BAAqB,GAAG,IAAI,aAAa,CAAU,CAAC,CAAC,CAAC;AAChE,KAUC;AACD,IAVE,IAAI,oBAAoB;AAAK,QAC3B,OAAO,IAAI,CAAC,qBAAqB;AACrC,aAAO,YAAY,EAAE;AACrB,aAAO,IAAI,CAAC,oBAAoB,EAAE,CAAC,CAAC;AACpC,KAAG;AACH,IACE,sBAAsB,CAAC,KAAc;AAAI,QACvC,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AAC3C,KAAG;AACH;sDAbC,UAAU;;;;gDACT;AAAC;AAAC,MCOS,qBAAqB;AAClC,IAKE,YACU,UAAsB,EACtB,gBAAkC,EAClC,YAA0B,EAC1B,MAAc,EACd,aAA4B,EAC5B,0BAAsD,EACtD,gBAAkC;AAC3C,QAPS,eAAU,GAAV,UAAU,CAAY;AAAC,QACvB,qBAAgB,GAAhB,gBAAgB,CAAkB;AAAC,QACnC,iBAAY,GAAZ,YAAY,CAAc;AAAC,QAC3B,WAAM,GAAN,MAAM,CAAQ;AAAC,QACf,kBAAa,GAAb,aAAa,CAAe;AAAC,QAC7B,+BAA0B,GAA1B,0BAA0B,CAA4B;AAAC,QACvD,qBAAgB,GAAhB,gBAAgB,CAAkB;AAC9C,QAbmB,aAAQ,GAAa,IAAI,CAAC,gBAAgB,CAAC,YAAY;AAC1E,aAAK,QAAQ,CAAC;AACd,QAAmB,aAAQ,GACvB,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,CAAC;AACtE,QAUI,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,KAAK,UAAU,EAAE;AAC7D,YAAM,IAAI,CAAC,qBAAqB,EAAE,CAAC;AACnC,YAAM,IAAI,CAAC,8BAA8B,EAAE,CAAC;AAC5C,SAAK;AAAC,aAAK;AACX,YAAM,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;AAC1D,SAAK;AACL,KAAG;AACH,IACE,qBAAqB;AAAK,QACxB,IAAI,CAAC,YAAY,CAAC,gBAAgB,EAAE,CAAC;AACzC,KAAG;AACH,IACE,MAAM,CAAC,uBAAgC,KAAK;AAAI,QAC9C,IAAI,CAAC,YAAY,CAAC,WAAW,GAAG,IAAI,CAAC,oBAAoB,CACvD,oBAAoB,CACrB,CAAC;AACN,QAAI,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;AAC/B,KAAG;AACH,IACE,qBAAqB;AAAK,QACxB,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACnC,KAAG;AACH,IACE,wBAAwB,CAAC,GAAW;AAAI,QACtC,IAAI,CAAC,YAAY,CAAC,qBAAqB,GAAG,GAAG,CAAC;AAClD,KAAG;AACH,IACU,qBAAqB;AAAK,QAChC,MAAM,aAAa,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;AAClD,QACI,MAAM,UAAU,GAAG;AACvB,YAAM,QAAQ,EAAE,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ;AACvD,YAAM,MAAM,EAAE,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC;AAC7D,YAAM,WAAW,EAAE,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC;AAClD,YAAM,wBAAwB,EAAE,IAAI,CAAC,QAAQ,GAAG,qBAAqB;AACrE,YAAM,qBAAqB,EAAE,IAAI,CAAC,QAAQ;AAC1C,SAAK,CAAC;AACN,QAAI,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;AAC5C,QACI,IAAI,aAAa,EAAE;AACvB,YAAM,IAAI,CAAC,YAAY,CAAC,iBAAiB,GAAG;AAC5C;AACQ;AACQ;AACQ,gBAAhB,SAAS,EAAE,aAAa;AAChC,aAAO,CAAC;AACR,SAAK;AACL,QACI,IAAI,CAAC,YAAY,CAAC,sBAAsB,GAAG,IAAI,qBAAqB,EAAE,CAAC;AAC3E,QAAI,IAAI,CAAC,YAAY;AACrB,aAAO,gCAAgC,EAAE;AACzC,aAAO,IAAI,CAAC,MACJ,IAAI,CAAC,0BAA0B,CAAC,sBAAsB,CACpD,IAAI,CAAC,YAAY,CAAC,eAAe,EAAE,CACpC,CACF;AACP,aAAO,KAAK,CAAC,MACL,IAAI,CAAC,0BAA0B,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAC9D,CAAC;AACR,QAAI,IAAI,CAAC,YAAY,CAAC,2BAA2B,EAAE,CAAC;AACpD,KAAG;AACH,IACU,oBAAoB,CAAC,oBAA6B;AAAI,QAC5D,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC;AAC/D,QAAI,OAAO,GAAG,QAAQ,KAAK,IAAI,GACzB,oBAAoB,GAAG,QAAQ,GAAG,MAAM,GAAG,EAC7C,EAAE,CAAC;AACP,KAAG;AACH,IACU,eAAe,CAAC,MAAc;AAAI,QACxC,OAAO,MAAM,CAAC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC;AACnD,KAAG;AACH,IACU,8BAA8B;AAAK,QACzC,IAAI,CAAC,YAAY,CAAC,MAAM;AAC5B,aAAO,IAAI,CACH,MAAM,CACJ,KAAK,IACH,KAAK,CAAC,IAAI,KAAK,sBAAsB;AACjD,YAAY,KAAK,CAAC,IAAI,KAAK,aAAa,CAC/B,EACD,IAAI,CAAC,CAAC,CAAC,CACR;AACP,aAAO,SAAS,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;AAC1C,KAAG;AACH,IACU,gBAAgB;AAAK;AAC2C;AAE1E;AACI,QAAA,MAAM,WAAW,GAAG,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,QAAQ,CAAC,MAAM,CAAC;AAC3E,QAAI,MAAM,SAAS,GAAG,IAAI,eAAe,CAAC,WAAW,CAAC,CAAC;AACvD,QACI,OAAO,SAAS,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;AACvC,KAAG;AACH;iDA/GC,UAAU;+HACT;AAAC;AACU,YAZJ,UAAU;AAAI,YAId,gBAAgB;AAAI,YACpB,YAAY;AAAI,YAHhB,MAAM;AAAI,YACF,aAAa;AAAI,YAKzB,0BAA0B;AAAI,YAT9B,gBAAgB;AAAG;;;+QAAE;AAAC;AAAC,MCQnB,kBAAkB;AAAG,IAChC,YACU,qBAA4C,EAC5C,0BAAsD;AAC/D,QAFS,0BAAqB,GAArB,qBAAqB,CAAuB;AAAC,QAC7C,+BAA0B,GAA1B,0BAA0B,CAA4B;AAClE,KAAM;AACN,IACE,WAAW;AAAK,QACd,OAAO,IAAI,CAAC,0BAA0B,CAAC,oBAAoB,CAAC,IAAI,CAC9D,GAAG,CAAC,CAAC,aAAsB;AACjC,YAAQ,IAAI,CAAC,aAAa,EAAE;AAC5B,gBAAU,IAAI,CAAC,qBAAqB,CAAC,qBAAqB,EAAE,CAAC;AAC7D,aAAS;AACT,SAAO,CAAC,CACH,CAAC;AACN,KAAG;AACH;8CAhBC,UAAU;sHACT;AAAC;AAA4C,YAHtC,qBAAqB;AAAI,YADzB,0BAA0B;AAAG;;;qHAAE;AAAC;AAAC,MCK7B,UAAU;AAAG,IACxB,YACU,qBAA4C,EAC5C,0BAAsD,EACtD,aAA4B,EAC5B,MAAc;AACvB,QAJS,0BAAqB,GAArB,qBAAqB,CAAuB;AAAC,QAC7C,+BAA0B,GAA1B,0BAA0B,CAA4B;AAAC,QACvD,kBAAa,GAAb,aAAa,CAAe;AAAC,QAC7B,WAAM,GAAN,MAAM,CAAQ;AAC1B,KAAM;AACN,IACE,WAAW;AAAK,QACd,OAAO,IAAI,CAAC,0BAA0B,CAAC,oBAAoB,CAAC,IAAI,CAC9D,GAAG,CAAC,CAAC,aAAsB;AACjC,YAAQ,IAAI,aAAa,EAAE;AAC3B,gBAAU,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;AACtC,gBAAU,OAAO,KAAK,CAAC;AACvB,aAAS;AAAC,iBAAK;AACf,gBAAU,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,KAAK,UAAU,EAAE;AACnE,oBAAY,IAAI,CAAC,qBAAqB,CAAC,qBAAqB,EAAE,CAAC;AAC/D,oBAAY,OAAO,KAAK,CAAC;AACzB,iBAAW;AACX,aAAS;AACT,YAAQ,OAAO,CAAC,aAAa,CAAC;AAC9B,SAAO,CAAC,CACH,CAAC;AACN,KAAG;AACH;sCAzBC,UAAU;8FACT;AAAC;AAAoC,YAH9B,qBAAqB;AAAI,YADzB,0BAA0B;AAAI,YAH9B,aAAa;AAAI,YADJ,MAAM;AAAG;;;8KAAE;AAAC;AAAC,MCgBtB,sBAAsB;AAAG,IACpC,YACU,WAAyB,EACzB,YAA6C,EAC7C,aAA4B,EAC5B,0BAAsD;AAC/D,QAJS,gBAAW,GAAX,WAAW,CAAc;AAAC,QAC1B,iBAAY,GAAZ,YAAY,CAAiC;AAAC,QAC9C,kBAAa,GAAb,aAAa,CAAe;AAAC,QAC7B,+BAA0B,GAA1B,0BAA0B,CAA4B;AAClE,KAAM;AACN,IACE,SAAS,CACP,GAAqB,EACrB,IAAiB;AAClB,QACC,MAAM,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC;AACtC,QACI,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE;AACpC,YAAM,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAC9B,SAAK;AACL,QACI,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,EAAE;AACzC,YAAM,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAC9B,SAAK;AACL,QACI,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE;AACrD,YAAM,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAC9B,SAAK;AACL,QACI,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE;AACzE,YAAM,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAC9B,SAAK;AACL,QACI,OAAO,IAAI,CAAC,0BAA0B,CAAC,oBAAoB,CAAC,IAAI,CAC9D,IAAI,CAAC,CAAC,CAAC,EACP,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAChB,QAAQ,CAAC;AACf,YAAQ,MAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;AAC/D,YAAQ,MAAM,MAAM,GAAG,SAAS,GAAG,KAAK,CAAC;AACzC,YAAQ,MAAM,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;AACjE,YAAQ,GAAG,GAAG,GAAG,CAAC,KAAK,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;AACrC,YAAQ,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAChC,SAAO,CAAC,EACF,UAAU,CAAC,GAAG,IAAI,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,GAAG,CAAC,CAAQ,CAC7D,CAAC;AACN,KAAG;AACH,IACU,QAAQ,CAAC,GAAW,EAAE,WAAqB;AAAI,QACrD,MAAM,KAAK,GAAG,WAAW,CAAC,IAAI,CAAC,CAAC,IAAI,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;AAC3D,QAAI,OAAO,CAAC,CAAC,KAAK,CAAC;AACnB,KAAG;AACH;kDAjDC,UAAU;kIACT;AAAC;AAAgD,YAPjD,YAAY;AACX,YAFD,+BAA+B;AAC/B,YAHO,aAAa;AAAI,YAOjB,0BAA0B;AAAG;;;qMAAE;AAAC;AAAC,MCJ7B,oCAAoC;AAC/C,IAIA,YACU,YAA0B,EAC1B,gBAAkC;AAC3C,QAFS,iBAAY,GAAZ,YAAY,CAAc;AAAC,QAC3B,qBAAgB,GAAhB,gBAAgB,CAAkB;AAC9C,QANmB,aAAQ,GAAa,IAAI,CAAC,gBAAgB,CAAC,YAAY;AAC1E,aAAK,QAAQ,CAAC;AACd,KAIM;AACN,IACE,WAAW,CAAC,GAAsB;AAAI,QACpC,IAAI,GAAG,CAAC,MAAM,KAAK,GAAG,EAAE;AAC5B,YAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACxB,YAAM,OAAO,KAAK,CAAC;AACnB,SAAK;AAAC,aAAK;AACX,YAAM,OAAO,UAAU,CAAC,GAAG,CAAC,CAAC;AAC7B,SAAK;AACL,KAAG;AACH,IACU,MAAM,CAAC,oBAA6B;AAAI,QAC9C,IAAI,CAAC,YAAY,CAAC,WAAW,GAAG,IAAI,CAAC,oBAAoB,CACvD,oBAAoB,CACrB,CAAC;AACN,QAAI,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;AAC/B,KAAG;AACH,IACU,oBAAoB,CAAC,oBAA6B;AAAI,QAC5D,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC;AAC/D,QAAI,OAAO,GAAG,QAAQ,KAAK,IAAI,GACzB,oBAAoB,GAAG,QAAQ,GAAG,MAAM,GAAG,EAC7C,EAAE,CAAC;AACP,KAAG;AACH;gEAjCC,UAAU;4KACT;AAAC;AACY,YANb,YAAY;AACX,YAJM,gBAAgB;AAAG;;;gHAAE;AAAC;AAAC,MCInB,wBAAwB;AAAG,IAItC,YACU,aAA4B,EAC5B,gBAAkC;AAC3C,QAFS,kBAAa,GAAb,aAAa,CAAe;AAAC,QAC7B,qBAAgB,GAAhB,gBAAgB,CAAkB;AAC9C,QANmB,WAAM,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;AACpE,QAAmB,YAAO,GAAG,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,cAAc,CAAC;AAC/E,KAIM;AACN,IACE,OAAO,CAAC,GAAW;AAAI,QACrB,OAAO,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC;AACxD,KAAG;AACH,IACE,UAAU,CAAC,GAAW;AAAI,QACxB,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC;AACpD,KAAG;AACH,IACE,OAAO,CAAC,GAAW,EAAE,IAAY;AAAI,QACnC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;AACvD,KAAG;AACH,IACU,YAAY,CAAC,GAAW;AAAI,QAClC,OAAO,GAAG,IAAI,CAAC,MAAM,IAAI,GAAG,EAAE,CAAC;AACnC,KAAG;AACH;oDAzBC,UAAU;wIACT;AAAC;AAAkD,YAL5C,aAAa;AAAI,YACjB,gBAAgB;AAAG;;;iHAAE;AAAC;AAAC,MCwCnB,oBAAoB;AACjC,IAAE,YAC0B,YAAkC,EAC9C,gBAAkC,EAClC,UAA4B,EAC5B,aAA4B;AACzC,QACC,IAAI,YAAY,EAAE;AACtB,YAAM,MAAM,IAAI,KAAK,CACb,6EAA6E,CAC9E,CAAC;AACR,SAAK;AACL,QAAI,IAAI,CAAC,gBAAgB,EAAE;AAC3B,YAAM,MAAM,IAAI,KAAK,CACb,8DAA8D,CAC/D,CAAC;AACR,SAAK;AACL,QAAI,IAAI,CAAC,UAAU,EAAE;AACrB,YAAM,MAAM,IAAI,KAAK,CACb,4DAA4D,CAC7D,CAAC;AACR,SAAK;AACL,QAAI,IAAI,CAAC,aAAa,EAAE;AACxB,YAAM,MAAM,IAAI,KAAK,CACb,2DAA2D,CAC5D,CAAC;AACR,SAAK;AACL,KAAG;AACH;gDAnDC,QAAQ,SAAC,kBACR,OAAO,EAAE,CAAC,YAAY,EAAE,WAAW,CAAC,OAAO,EAAE,CAAC,kBAC9C,YAAY,EAAE,EAAE,kBAChB,SAAS,EAAE,sBACT,qBAAqB,sBACrB,0BAA0B;gBAC1B,kBAAkB,sBAClB,UAAU;GACV,0BACE,OAAO,EAAE,iBAAiB;cAC1B,QAAQ,EAAE;eAAsB;KAChC,KAAK,EAAE,IAAI;UACZ;;EACD,0BACE,OAAO,EAAE;SAAY,0BACrB,QAAQ,EAAE;uBAAwB;;;AACnC,sBACD;aACE,OAAO,EAAE;MAA+B;;WACxC,QAAQ,EAAE;GAAoC,sBAC/C,kBACF,cACF;;2DACI;AAAC;AAEL,YAAyC,oBAAoB,uBAAzD,QAAQ,YAAI,QAAQ;AAAO,YAxCvB,gBAAgB,uBAyCpB,QAAQ;AAAO,YA5CQ,gBAAgB,uBA6CvC,QAAQ;AAAO,YA3CX,aAAa,uBA4CjB,QAAQ;AAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAAE;AAAC;AC/CtB;AACA;AACA;AACA;ACHA;AACA;AACA;AACA;AACA;AAC8K","sourcesContent":["import { Injectable } from '@angular/core';\nimport { Observable, ReplaySubject } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\n@Injectable()\nexport class AuthenticatedResultService {\n  private _authenticatedResult$ = new ReplaySubject<boolean>(1);\n\n  get authenticatedResult$(): Observable<boolean> {\n    return this._authenticatedResult$\n      .asObservable()\n      .pipe(distinctUntilChanged());\n  }\n\n  setAuthenticatedResult(value: boolean): void {\n    this._authenticatedResult$.next(value);\n  }\n}\n","import { PlatformLocation } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Config, ConfigService } from '@sofico-framework/app-config';\nimport { WindowRefService } from '@sofico-framework/utils';\nimport { OAuthService } from 'angular-oauth2-oidc';\nimport { JwksValidationHandler } from 'angular-oauth2-oidc-jwks';\nimport { filter, take } from 'rxjs/operators';\nimport { AuthenticatedResultService } from './authenticated-result.service';\n\n@Injectable()\nexport class AuthenticationService {\n  private readonly location: Location = this.windowRefService.nativeWindow\n    .location;\n  private readonly baseHref =\n    this.location.origin + this.platformLocation.getBaseHrefFromDOM();\n\n  constructor(\n    private httpClient: HttpClient,\n    private windowRefService: WindowRefService,\n    private oauthService: OAuthService,\n    private router: Router,\n    private configService: ConfigService,\n    private authenticatedResultService: AuthenticatedResultService,\n    private platformLocation: PlatformLocation\n  ) {\n    if (this.configService.config.auth.grant === 'implicit') {\n      this.configureLoginWithSSO();\n      this.listenOnErrorReceivedAndLogout();\n    } else {\n      throw new Error('unsupported authentication grant');\n    }\n  }\n\n  loginWithSingleSignOn(): void {\n    this.oauthService.initImplicitFlow();\n  }\n\n  logout(pathBasedRedirectUri: boolean = false): void {\n    this.oauthService.redirectUri = this.calculateRedirectUri(\n      pathBasedRedirectUri\n    );\n    this.oauthService.logOut();\n  }\n\n  logoutWithoutRedirect(): void {\n    this.oauthService.logOut(true);\n  }\n\n  setPostLogoutRedirectUri(uri: string): void {\n    this.oauthService.postLogoutRedirectUri = uri;\n  }\n\n  private configureLoginWithSSO(): void {\n    const languageParam = this.getLanguageParam();\n\n    const authConfig = {\n      clientId: this.configService.config.auth.clientId,\n      issuer: this.calculateIssuer(this.configService.config),\n      redirectUri: this.calculateRedirectUri(true),\n      silentRefreshRedirectUri: this.baseHref + 'silent-refresh.html',\n      postLogoutRedirectUri: this.baseHref\n    };\n    this.oauthService.configure(authConfig);\n\n    if (languageParam) {\n      this.oauthService.customQueryParams = {\n        // kc_locale because it set a cookie automatically\n        // that contains the language parameter so it's saved\n        // when you refresh and wait to long before you take an action\n        kc_locale: languageParam\n      };\n    }\n\n    this.oauthService.tokenValidationHandler = new JwksValidationHandler();\n    this.oauthService\n      .loadDiscoveryDocumentAndTryLogin()\n      .then(() =>\n        this.authenticatedResultService.setAuthenticatedResult(\n          this.oauthService.hasValidIdToken()\n        )\n      )\n      .catch(() =>\n        this.authenticatedResultService.setAuthenticatedResult(false)\n      );\n    this.oauthService.setupAutomaticSilentRefresh();\n  }\n\n  private calculateRedirectUri(pathBasedRedirectUri: boolean): string {\n    const { protocol, host, pathname, search } = this.location;\n    return `${protocol}//${host}${\n      pathBasedRedirectUri ? pathname + search : ''\n    }`;\n  }\n\n  private calculateIssuer(config: Config): string {\n    return config.auth.baseUrl + config.auth.realm;\n  }\n\n  private listenOnErrorReceivedAndLogout(): void {\n    this.oauthService.events\n      .pipe(\n        filter(\n          event =>\n            event.type === 'silent_refresh_error' ||\n            event.type === 'token_error'\n        ),\n        take(1)\n      )\n      .subscribe(() => this.logout(true));\n  }\n\n  private getLanguageParam(): string {\n    // the reason why we're using windowRefService instead of activatedRouter\n    // to get the router params is because activatedRouter params has no value.\n    // This is because there is no NavigationEnd event on Router\n    const queryString = this.windowRefService.nativeWindow.location.search;\n    const urlParams = new URLSearchParams(queryString);\n\n    return urlParams.get('ui_locales');\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CanActivate } from '@angular/router';\nimport { Observable } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { AuthenticatedResultService } from '../services/authenticated-result.service';\nimport { AuthenticationService } from '../services/authentication.service';\n\n@Injectable()\nexport class AuthenticatedGuard implements CanActivate {\n  constructor(\n    private authenticationService: AuthenticationService,\n    private authenticatedResultService: AuthenticatedResultService\n  ) {}\n\n  canActivate(): Observable<boolean> {\n    return this.authenticatedResultService.authenticatedResult$.pipe(\n      tap((authenticated: boolean) => {\n        if (!authenticated) {\n          this.authenticationService.loginWithSingleSignOn();\n        }\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CanActivate, Router } from '@angular/router';\nimport { ConfigService } from '@sofico-framework/app-config';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { AuthenticatedResultService } from '../services/authenticated-result.service';\nimport { AuthenticationService } from '../services/authentication.service';\n\n@Injectable()\nexport class GuestGuard implements CanActivate {\n  constructor(\n    private authenticationService: AuthenticationService,\n    private authenticatedResultService: AuthenticatedResultService,\n    private configService: ConfigService,\n    private router: Router\n  ) {}\n\n  canActivate(): Observable<boolean> {\n    return this.authenticatedResultService.authenticatedResult$.pipe(\n      map((authenticated: boolean) => {\n        if (authenticated) {\n          this.router.navigate(['/']);\n          return false;\n        } else {\n          if (this.configService.config.auth.grant === 'implicit') {\n            this.authenticationService.loginWithSingleSignOn();\n            return false;\n          }\n        }\n        return !authenticated;\n      })\n    );\n  }\n}\n","import {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { ConfigService } from '@sofico-framework/app-config';\nimport {\n  OAuthResourceServerErrorHandler,\n  OAuthStorage\n} from 'angular-oauth2-oidc';\nimport { Observable } from 'rxjs';\nimport { catchError, filter, mergeMap, take } from 'rxjs/operators';\nimport { AuthenticatedResultService } from '../services/authenticated-result.service';\n\n@Injectable()\nexport class CustomOAuthInterceptor implements HttpInterceptor {\n  constructor(\n    private authStorage: OAuthStorage,\n    private errorHandler: OAuthResourceServerErrorHandler,\n    private configService: ConfigService,\n    private authenticatedResultService: AuthenticatedResultService\n  ) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const url = req.url.toLowerCase();\n\n    if (!this.configService.config) {\n      return next.handle(req);\n    }\n\n    if (!this.configService.config.auth) {\n      return next.handle(req);\n    }\n\n    if (!this.configService.config.auth.allowedUrls) {\n      return next.handle(req);\n    }\n\n    if (!this.checkUrl(url, this.configService.config.auth.allowedUrls)) {\n      return next.handle(req);\n    }\n\n    return this.authenticatedResultService.authenticatedResult$.pipe(\n      take(1),\n      filter(v => !!v),\n      mergeMap(() => {\n        const token = this.authStorage.getItem('access_token');\n        const header = 'Bearer ' + token;\n        const headers = req.headers.set('Authorization', header);\n        req = req.clone({ headers });\n        return next.handle(req);\n      }),\n      catchError(err => this.errorHandler.handleError(err)) as any\n    );\n  }\n\n  private checkUrl(url: string, allowedUrls: string[]): boolean {\n    const found = allowedUrls.find(u => url.startsWith(u));\n    return !!found;\n  }\n}\n","import { HttpResponse } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { WindowRefService } from '@sofico-framework/utils';\nimport {\n  OAuthResourceServerErrorHandler,\n  OAuthService\n} from 'angular-oauth2-oidc';\nimport { EMPTY, Observable, throwError } from 'rxjs';\n\n@Injectable()\nexport class ResourceServerAutoLogoutErrorHandler\n  implements OAuthResourceServerErrorHandler {\n  private readonly location: Location = this.windowRefService.nativeWindow\n    .location;\n\n  constructor(\n    private oauthService: OAuthService,\n    private windowRefService: WindowRefService\n  ) {}\n\n  handleError(err: HttpResponse<any>): Observable<any> {\n    if (err.status === 401) {\n      this.logout(true);\n      return EMPTY;\n    } else {\n      return throwError(err);\n    }\n  }\n\n  private logout(pathBasedRedirectUri: boolean): void {\n    this.oauthService.redirectUri = this.calculateRedirectUri(\n      pathBasedRedirectUri\n    );\n    this.oauthService.logOut();\n  }\n\n  private calculateRedirectUri(pathBasedRedirectUri: boolean): string {\n    const { protocol, host, pathname, search } = this.location;\n    return `${protocol}//${host}${\n      pathBasedRedirectUri ? pathname + search : ''\n    }`;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ConfigService } from '@sofico-framework/app-config';\nimport { WindowRefService } from '@sofico-framework/utils';\nimport { OAuthStorage } from 'angular-oauth2-oidc';\n\n@Injectable()\nexport class SessionStorageOAuthStore implements OAuthStorage {\n  private readonly prefix = this.configService.config.auth.clientId;\n  private readonly storage = this.windowRefService.nativeWindow.sessionStorage;\n\n  constructor(\n    private configService: ConfigService,\n    private windowRefService: WindowRefService\n  ) {}\n\n  getItem(key: string): string | null {\n    return this.storage.getItem(this.calculateKey(key));\n  }\n\n  removeItem(key: string): void {\n    this.storage.removeItem(this.calculateKey(key));\n  }\n\n  setItem(key: string, data: string): void {\n    this.storage.setItem(this.calculateKey(key), data);\n  }\n\n  private calculateKey(key: string): string {\n    return `${this.prefix}_${key}`;\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { HTTP_INTERCEPTORS, HttpClientModule } from '@angular/common/http';\nimport { NgModule, Optional, SkipSelf } from '@angular/core';\nimport { ConfigService } from '@sofico-framework/app-config';\nimport { WindowRefService } from '@sofico-framework/utils';\nimport {\n  OAuthModule,\n  OAuthResourceServerErrorHandler,\n  OAuthStorage\n} from 'angular-oauth2-oidc';\nimport { AuthenticatedGuard } from './guards/authenticated.guard';\nimport { GuestGuard } from './guards/guest.guard';\nimport { CustomOAuthInterceptor } from './interceptors/custom-oauth.interceptor';\nimport { ResourceServerAutoLogoutErrorHandler } from './interceptors/resource-server-auto-logout-error-handler';\nimport { AuthenticatedResultService } from './services/authenticated-result.service';\n\nimport { AuthenticationService } from './services/authentication.service';\nimport { SessionStorageOAuthStore } from './stores/session-storage-oauth.store';\n\n@NgModule({\n  imports: [CommonModule, OAuthModule.forRoot()],\n  declarations: [],\n  providers: [\n    AuthenticationService,\n    AuthenticatedResultService,\n    AuthenticatedGuard,\n    GuestGuard,\n    {\n      provide: HTTP_INTERCEPTORS,\n      useClass: CustomOAuthInterceptor,\n      multi: true\n    },\n    {\n      provide: OAuthStorage,\n      useClass: SessionStorageOAuthStore\n    },\n    {\n      provide: OAuthResourceServerErrorHandler,\n      useClass: ResourceServerAutoLogoutErrorHandler\n    }\n  ]\n})\nexport class AuthenticationModule {\n  constructor(\n    @Optional() @SkipSelf() parentModule: AuthenticationModule,\n    @Optional() windowRefService: WindowRefService,\n    @Optional() httpClient: HttpClientModule,\n    @Optional() configService: ConfigService\n  ) {\n    if (parentModule) {\n      throw new Error(\n        'AuthenticationModule is already loaded. Import in your base AppModule only.'\n      );\n    }\n    if (!windowRefService) {\n      throw new Error(\n        'You need to import the UtilServicesModule in your AppModule!'\n      );\n    }\n    if (!httpClient) {\n      throw new Error(\n        'You need to import the HttpClientModule in your AppModule!'\n      );\n    }\n    if (!configService) {\n      throw new Error(\n        'You need to import the AppConfigModule in your AppModule!'\n      );\n    }\n  }\n}\n","/*\n * Public API Surface of authentication\n */\n\n// guards\nexport * from './lib/guards/authenticated.guard';\nexport * from './lib/guards/guest.guard';\n\n// interceptors\nexport * from './lib/interceptors/custom-oauth.interceptor';\nexport * from './lib/interceptors/resource-server-auto-logout-error-handler';\n\n// services\nexport * from './lib/services/authenticated-result.service';\nexport * from './lib/services/authentication.service';\n\n// stores\nexport * from './lib/stores/session-storage-oauth.store';\n\n// types\nexport * from './lib/types/activation-code.type';\nexport * from './lib/types/activation-code-request.type';\nexport * from './lib/types/activation-code-result.type';\nexport * from './lib/types/authentication-result.type';\nexport * from './lib/types/authentication-config.type';\n\n// modules\nexport * from './lib/authentication.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"]}